%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% This is a (brief) model paper using the achemso class
%% The document class accepts keyval options, which should include
%% the target journal and optionally the manuscript type. 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\documentclass[journal=jacsat,manuscript=article]{achemso}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Place any additional packages needed here.  Only include packages
%% which are essential, to avoid problems later. Do NOT use any
%% packages which require e-TeX (for example etoolbox): the e-TeX
%% extensions are not currently available on the ACS conversion
%% servers.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage[version=3]{mhchem} % Formula subscripts using \ce{}
\usepackage{bm}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% If issues arise when submitting your manuscript, you may want to
%% un-comment the next line.  This provides information on the
%% version of every file you have used.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%\listfiles

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Place any additional macros here.  Please use \newcommand* where
%% possible, and avoid layout-changing macros (which are not used
%% when typesetting).
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcommand*\mycommand[1]{\texttt{\emph{#1}}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Meta-data block
%% ---------------
%% Each author should be given as a separate \author command.
%%
%% Corresponding authors should have an e-mail given after the author
%% name as an \email command. Phone and fax numbers can be given
%% using \phone and \fax, respectively; this information is optional.
%%
%% The affiliation of authors is given after the authors; each
%% \affiliation command applies to all preceding authors not already
%% assigned an affiliation.
%%
%% The affiliation takes an option argument for the short name.  This
%% will typically be something like "University of Somewhere".
%%
%% The \altaffiliation macro should be used for new address, etc.
%% On the other hand, \alsoaffiliation is used on a per author basis
%% when authors are associated with multiple institutions.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\author{Joseph P. Heindel}
\affiliation[Berkeley]
{Kenneth S. Pitzer Theory Center and Department of Chemistry, University of California, Berkeley, California94720, United States}
\alsoaffiliation[LBL]
{Chemical Sciences Division, Lawrence Berkeley National Laboratory, Berkeley, California94720, United States}
\author{Teresa Head-Gordon}
\email{thg@berkeley.edu}
\affiliation[Berkeley]
{Kenneth S. Pitzer Theory Center and Department of Chemistry, University of California, Berkeley, California94720, United States}
\alsoaffiliation[LBL]
{Chemical Sciences Division, Lawrence Berkeley National Laboratory, Berkeley, California94720, United States}
\alsoaffiliation[Berkeley2]
{Departments of Bioengineering and Chemical and Biomolecular EngineeringUniversity of California, Berkeley, California94720, United States}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% The document title should be given as usual. Some journals require
%% a running title from the author: this should be supplied as an
%% optional argument to \title.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\title[An \textsf{achemso} demo]
  {Construction of Accurate Force Fields from Energy Decomposition Analysis: Water and Monovalent Ions}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Some journals require a list of abbreviations or keywords to be
%% supplied. These should be set up here, and will be printed after
%% the title and author information, if needed.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\keywords{American Chemical Society, \LaTeX}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% The manuscript does not need to include \maketitle, which is
%% executed automatically.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% The "tocentry" environment can be used to create an entry for the
%% graphical table of contents. It is given here as some journals
%% require that it is printed as part of the abstract page. It will
%% be automatically moved as appropriate.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{tocentry}

Some journals require a graphical entry for the Table of Contents.
This should be laid out ``print ready'' so that the sizing of the
text is correct.

Inside the \texttt{tocentry} environment, the font used is Helvetica
8\,pt, as required by \emph{Journal of the American Chemical
Society}.

The surrounding frame is 9\,cm by 3.5\,cm, which is the maximum
permitted for  \emph{Journal of the American Chemical Society}
graphical table of content entries. The box will not resize if the
content is too big: instead it will overflow the edge of the box.

This box and the associated title will always be printed on a
separate page at the end of the document.

\end{tocentry}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% The abstract environment will automatically gobble the contents
%% if an abstract is not used by the target journal.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{abstract}
  TODO
\end{abstract}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Start the main part of the manuscript here.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Introduction}
Historically, there have been two main approaches to including
polarization in force fields: fluctuating charges\cite{rick1994dynamical}
or induced dipoles\cite{applequist1985multipole}. There have also been
attempts to unify these approaches allowing for both charge rearrangements
and induced dipoles.\cite{stern2001combined}

Our goal in this paper is to develop a new class of polarizable
force field which is able to quantitatively reproduce all of the terms
from energy decomposition analysis (EDA). The reason to do this
is that by reproducing the EDA term-by-term, we can ensure that the force
field will be transferable across the phase diagram of a homogeneous
system and to new heterogenous systems.
Additionally, by reproducing the EDA term-by-term, the force field
is able to provide insights which many other models simply cannot because
they do not include particular terms. For instance, many force fields
do not include charge transfer or charge penetrations terms.
Many force fields also use terms which package the Pauli repulsion and dispersion 
energies together. We will discuss this further in the results section,
but by neglecting these terms, one limits the interpretability of the
energies and forces predicted by a force field. Even worse, one can only
exclude charge transfer and charge penetration from force fields because
these energies are strongly correlated to the Pauli repulsion (see Fig. 1).
This correlation is not guaranteed to be consistent between systems, however,
which may explain part of the difficulty in producing water models which
generalize to heterogeneous systems.

\section{Theory}
EDA splits the interaction energy into five components: Pauli repulsion,
electrostatics, dispersion, polarization, and charge transfer. The force
field described in this work will model each of these term by term, resulting
in two different models, which we will call the dipole model (DM) and
anisotropic model (AM). Note we will use a convention of referring to all energy
terms in the force field with a $V$ and all energy terms from electronic structre
with an $E$.

Our approach builds on the density overlap hypothesis\cite{kim1981dependence,wheatley1990overlap,gavezzotti2002calculation,van2016beyond}
which states that the short-range contributions to intermolecular
interactions is proportional to the electron density overlap. In order
for this idea to be amenable to force fields, one must use atom-centered
density overlaps. One way of doing this was developed thoroughly by
Misquitta and others\cite{misquitta2014distributed,misquitta2018isa} based
on iterated stockholder atoms which can be used to define Slater-like
densities for atoms in molecules. Since this approach has been discussed
extensivly, we will only summarize the salient points.

One can show that the overlap, $S^{ii}_\rho$, of two identical Slater-like atomic densities
at different locations, $\rho_i(\bm{r}_i)$ and $\rho_i(\bm{r}_j)$, is,
\begin{equation}
  S_{ii}^\rho=\frac{\pi D^2}{b_{ii}^3}P(b_{ii}r_{ij})\exp(-b_{ii}r_{ij})
\end{equation}
The above overlap expression is only strictly true for the exponential tail
of the Slater density and for identical atoms. The overlap between atoms
with different densities, $S^{ij}_\rho$, has a more complicated form, but
it has been shown that setting $b_{ij}=\sqrt{b_ib_j}$ allows the expression
for $S_{ii}^\rho$ to be used for different atom types with negligible
approximation\cite{van2016beyond}. The polynomial prefactor in the overlap is,
\begin{equation}
  P(b_{ij}r_{ij})=\frac13(b_{ij}r_{ij})^2 + b_{ij}r_{ij}+1
\end{equation}
where, again, we will use the combination rule $b_{ij}=\sqrt{b_ib_j}$.

\subsection*{Pauli Repulsion}
The original aim of the density overlap model was to model the
Pauli repulsion energy.\cite{wallqvist1989new,wheatley1990overlap,gordon1996approximate}
In this work, we employ two different models for Pauli repsulison,
both inspired by the work of Van Vleet \textit{et al.}\cite{van2016beyond,van2018new}.
The first is a simple isotropic model of Pauli repulsion where the energy is proportional
to the density overlap with a quadratic term that we found essentialy for ion-ion interactions
at shorter-than-equilibrium distances,
\begin{equation}
  V^{exch} = \sum_{i<j}a_{ij}^{(1),exch}S_{ij}^\rho+a_{ij}^{(2),exch}(S_{ij}^\rho)^2
  \label{eq:exch_iso}
\end{equation}

In Eq. \ref{eq:exch_iso}, $a_{ij}^{exch}=a_{i}^{exch}a_{j}^{exch}$ where
$a_{i}^{exch}$ is a free parameter for atom $i$. This isotropic sum is the
approach we use for the DM model. In the anisotropic model (AM), we,
unsurprisingly, put anisotropy into the atom-specific parameters.
We do this similarly to the approach of Van Vleet, but with some minor
modifications\cite{van2018new}. First, the anisotropy is introduced by multiplying
the isotropic term with a spherical harmonic expansion. The spherical harmonics
used here are given by,
\begin{equation}
  C_{lm}(\theta,\phi)=\sqrt{\frac{4\pi}{2l+1}}Y_{lm}(\theta,\phi)
\end{equation}
where $\theta$ and $\phi$ are the polar and azimuthal angles
calculated between two local axis systems for each atom.\cite{bernardo1994anisotropic}
That is, $\theta_i$ is the angle of the vector between two axis systems,
$\bm{r}_{ij}=\bm{r}_j-\bm{r}_i$, and the z-axis of axis system $i$.
$\phi_i$ is the azimuthal angle, which is the angle of $\bm{r}_{ij}$ in the range $[0,2\pi]$ from the
x-axis of axis system $i$.
\begin{equation}
  a_i^{exch} = a_{i,iso}^{exch}\left(1 + \sum_{l>0,k}a_{i,lk}^{exch}C_{lk}(\theta_i,\phi_i)\right)
  \label{eq:exch_params_aniso}
\end{equation}

\subsection*{Electrostatics}

Our description of electrostatics comes from a traditional
point multipole approach and a charge penetration contribution. We will refer to
these contributions as the DMA energy and CP energy, respectively.
Our working definition of charge penetration comes by taking the
classical electrostatic energy from EDA minus the interaction energy
when using Stone's distributed multipole analysis\cite{stone1981distributed,stone1985distributeda}
out to hexadecapoles on all atoms.

\begin{equation}
  E^{CP}=E^{elec}_{EDA}-E^{elec}_{DMA}
\end{equation}

The advantage of this approach is it allows us to ensure that
our multipoles are not biased to compensate for error in the
description of charge penetration, which is essential to reproduce
the classical electrostatic energy in EDA.
All distributed multipole calculations were carried out
in Stone's Orient program.\cite{stone2002orient}

Our description of charge penetration in the models is essentially
the same as for Pauli repulsion. Namely, the DM model uses only
isotropic terms and includes a quadratic overlap term which, again,
is immensely helpful for the short range description of ion-ion interactions:

\begin{equation}
  V^{CP} = \sum_{i<j}a_{ij}^{(1),CP}S_{ij}^\rho+a_{ij}^{(2),CP}(S_{ij}^\rho)^2
  \label{eq:exch_iso}
\end{equation}

For the AM model, we include anisotropy in the first order charge penetration
parameter, $a_{ij}^{(1),CP}$, in the same way as for exchange in Eq. (\ref{eq:exch_params_aniso}).

The permanent point electrostatics aim to reproduce the distributed
multipole energies used in defining the charge penetration, $E^{elec}_{DMA}$.
The electrostatic energy is expressed as,

\begin{equation}
  E_{elec} = \sum_{i<j}\mathbf{M}_i\mathbf{T}_{ij}\mathbf{M}_j
  \label{eq:elec}
\end{equation}
\noindent
where $\mathbf{M}_i$ is a vector of multipole components (i.e. the charge,
dipole, and quadrupole components) centered on atom $i$ and $\mathbf{T}_{ij}$ is
the multipole interaction tensor formed by taking successive gradients of $1/r_{ij}$\cite{stone2013theory}.

\section*{Polarization}

We introduce a combined fluctuating charge (FQ) and induced dipole model of electronic
polarization. There are two reasons we have pursued this combined polarization
approach. The first is quite simple. We want to reproduce all terms from EDA,
one of which is charge transfer. If charges are not allowed to vary, then one
cannot model the explicit transfer of charge between molecules. The second reason is
that atomic polarizabilities naturally contain both charge-flow and induced dipole
contributions.\cite{stone1985distributedb} Typically, the charge-flow contributions
are localized away\cite{ruth1994localization}, but our approach does not require nonlocal
charge flow polarizabilities.

The FQ contribution to our polarization model is a modification of the electronegativity
equalization model (EEM) of polarization.\cite{mortier1986electronegativity} In EEM,
the energy of a molecule is expanded to second-order as a function of charge, then,
these charges are allowed to interact. Mathematically, this takes the following form,
\begin{equation}
  V(\bm{q})=\sum_i \chi_i q_i + \frac12 \sum_i \eta_i q_i^2 + \sum_{i<j} \frac{q_i q_j}{r_{ij}}
  \label{eq:eem}
\end{equation}

In Eq. \ref{eq:eem}, $\chi_i$ represents the electronegativity of atom $i$ and
$\eta_i$ is the atomic hardness of atom $i$. The principle of electronegativity
equalization states that  at equilibrium, the electronegativity of all atoms
will become equal. This allows the charges in an atom to be determined by solving
a system of linear equations. There are several known shortcomings of EEM. The first
is the long-range transfer of charge between molecules, even at infinite distance,
which is unrealistic for the dielectric systems studied here.\cite{chen2007qtpie,chen2008unified}
Our solution to this problem is to only allow charge rearrangements within
a molecule and not between molecules. This constraint can be introduced using
Lagrange multipliers. A second limitation of EEM is that the approach in Eq. \ref{eq:eem}
gives back the total charge of atoms in a molecule. This is somewhat awkward because
we want to separate the multipolar electrostatics, which depends on the total charge,
from the polarization contribution which should only depend on the external potential
and field experienced by each atom. Hence, we drop the linear term and focus only on the
fluctuation of charges around the reference charge used for permanent electrostatics.
Another way of viewing this is that we are equalizing electronegativity around an "already
equalized" state. The change in electronegativity at each atom due to an environment is simply
the electric potential at that atom. We can then write the FQ contribution in our
model as,
\begin{equation}
  V(\delta \bm{q})=\frac12\sum_i \eta_i \delta q_i^2 + \sum_i \delta q_i V_i + \sum_{i<j}\frac{\delta q_i \delta q_j}{r_{ij}} + \sum_{\alpha}\lambda_\alpha \sum_{i\in\alpha}\delta q_{i}
  \label{eq:fq}
\end{equation}

To summarize, Eq. \ref{eq:fq} allows charges to rearrange, $\delta q_i$, in response to an external
potential, $V_i$, with a quadratic penalty determined by the atomic hardness, $\eta_i$.
The charge rearrangements are constrained to only occur between atoms such that rearranged
charges in a molecule sum to the total charge of a molecule. Therefore, the model has $N$ lagrange
multipliers, $\lambda_\alpha$, where $N$ is the number of molecules in the system. These molecules
could be water or an ion in this work. Note that all fluctuating charges (and induced
dipoles) are allowed to interact whether they are in the same molecule or not.

We also allow electric fields due to the environment to induce dipoles on all atoms.
The energy of an induced dipole in an electric field, $\bm{E}$, including mutual polarization is,
\begin{equation}
  V(\bm{\mu}^{ind})=-\frac12\sum_i \bm{\mu}_i^{ind}\cdot \bm{E}_i + \sum_{i<j}\bm{\mu}^{ind}_i \bm{T}^{\mu\mu}_{ij}\bm{\mu}^{ind}_j
  \label{eq:induced_dipoles}
\end{equation}

In Eq. \ref{eq:induced_dipoles}, the induced dipoles at each polarizable site, $\bm{\mu}_i^{ind}$,
interact with an external electric field, $\bm{E}_i$, and with each other via the dipole interaction tensor.
We will have more to say about this tensor in the next section when we discuss the short-range damping of polarization.

What now remains is to determine the values of $\delta \bm{q}$ and $\bm{\mu}^{ind}$
which minimize the total energy of the system. In order to do this, we take
the derivative with respect to each $\delta q_i$ and each component of each
$\bm{\mu}_i^{ind}$ and set them all equal to zero. This results in a system of linear
equations which can be written succintly as follows:


\begin{equation}
  \begin{pmatrix}
    \bm{T}^{qq} & \bm{1}_\lambda & \bm{T}^{q\mu} \\
    \bm{1}_\lambda^\dagger & 0 & 0 \\
    -\bm{T}^{\mu q} & 0 & \bm{T}^{\mu\mu} \\
  \end{pmatrix}
  \begin{pmatrix}
    \delta \bm{q} \\
    \bm{\lambda} \\
    \bm{\mu} \\
  \end{pmatrix}
  =
  \begin{pmatrix}
    -\bm{V} \\
    \bm{Q} \\
    \bm{E} \\
  \end{pmatrix}
  \label{eq:pol_mat}
\end{equation}

The solution vector in Eq. \ref{eq:pol_mat} contains the electric potential,
$\bm{V}$, the total charges of each molecule, $\bm{Q}$, and the electric
field on each atom $\bm{E}$. The matrix has several blocks containing the
charge-charge ($\bm{T}^{qq}$), charge-dipole ($\bm{T}^{q\mu}$),
dipole-charge ($\bm{T}^{\mu q}$), and dipole-dipole interaction tensors ($\bm{T}^{\mu\mu}$).
Note that the diagonal elements of $\bm{T}^{qq}$ are the atomic hardness $\eta$ and
the $3\times 3$ diagonal blocks of $\bm{T}^{\mu\mu}$ are the inverse polarizability tensor
$\bm{\alpha}_i^{-1}$. The block $\bm{1}_\lambda$ has a column for each molecule in the system.
An entry in that column is 1 if the $i$th atom is in that molecule and zero otherwise.
These blocks enforce the charge-conservation constraints for each molecule.
Finally, $\delta\bm{q}$ contains the optimally rearranged charges, $\bm{\lambda}$ contains
the Lagrange multipliers which enforce charge conservation, and $\bm{\mu}$ are the induced dipoles.

The form of the $ij$ entries of the multipole interaction tensors are as follows:
\begin{align}
  T^{qq}_{ij}&=f_3(x_{ij})\frac{1}{r_{ij}} \\
  \bm{T}^{q\mu}_{ij}&=f_5(x_{ij})\frac{-\bm{r}_{ij}}{r_{ij}^3} \\
  \bm{T}^{\mu\mu}_{ij}&=f_7(x_{ij})\left(\frac{\bm{r}_{ij}\otimes\bm{r}_{ij}}{r_{ij}^5}-\frac{\bm{1}}{r_{ij}^3}\right)
  \label{eq:tensors}
\end{align}

The interaction tensors in Eq. \ref{eq:tensors} are the usual cartesian multipole interaction
tensors, generated by successive gradients of $1/r_{ij}$ where $r_{ij}$ is the distance between
two atoms. These tensors are multiplied by a damping function, which we will discuss in more detail
now.

\section*{Damping}

The interaction tensors in Eq. \ref{eq:pol_mat} are often
damped to prevent over-polarization. One common approach is to use Thole damping\cite{thole1981molecular},
which takes a model electron density and computes the appropriate damping function. This approach is
a bit awkward both because it requires an arbitrary parameter which controls the extent of damping,
but also because the model electron densities chosen have no apparent physical meaning.
For those reasons, we take a different approach in damping all terms related to polarization and
utilize the Tang-Toennies (TT) damping functions\cite{tang1984improved}.

\begin{equation}
  f_n(x_{ij}) = 1-e^{-x_{ij}}\sum_{k=0}^n\frac{x_{ij}^k}{k!}
  \label{eq:TT}
\end{equation}

The appropriate form of $x$ for the tail of a Slater electron density
has been derived before\cite{van2016beyond} and takes the form,
\begin{equation}
  x_{ij}=b_{ij}r_{ij}-\frac{2b_{ij}^2r_{ij}^2+3b_{ij}r_{ij}}{b_{ij}^2r_{ij}^2+3b_{ij}r_{ij}+3}
  \label{eq:TT_x}
\end{equation}

There are two big advantages to TT damping functions worth discussing. First, as
shown in Eq. \ref{eq:TT_x}, the scale over which damping is relevant is related to the
Slater exponent for each pair of atoms, $b_{ij}$. This is convenient because it means the
damping between each pair of atoms will better reflect the size of each atom. Additionally,
by reusing these Slater exponents, we eliminate the need for the global parameter used
to control the damping strength in Thole damping. Note that the TT damping functions
depend parametrically on the choice of integer $n$. Generally, higher $n$ means
damping occurs more rapidly. This brings us to the second advantage. TT damping
allows us to apply different damping scales to different types of interactions
just by modifying the value of $n$.

In the original work by Tang and Toennies, they show that the appropriate choice
of $n$ for dispersion is $n=6$. This makes sense because the damping function will
then have an exponential multiplied by a sixth order polynomial. This polynomial is
able to control the $r^{-6}$ scaling of dispersion, while the exponential ensures no
damping at long distances.

Inspired by this, we choose to damp mutual polarization with $n=3,5,7$ for
charge-charge, charge-dipole, and dipole-dipole interactions, respectively.
The reason we choose $n=3,5,7$ is because mutual polarization
roughly decays as the square of permanent interactions of the same type. This
would mean $n=2,4,6$ are an appropriate choice. We have tried both
sets of $n$ and found very little difference between the two, so we picked the stronger damping
to ensure that polarization catastrophes cannot occur.

The typical Thole damping functions also take the form of a polynomial
multiplied by an exponential. The polynomial for damping induced dipoles is third-order in Thole damping,
which, as just discussed, is insufficient to control the polarization
energy at short-range. Therefore, we consider our more aggressive damping to be well-justified
especially since we are interested in ions where polarization catastrophes have
motivated the use of unphysically diminished polarizabilities.\cite{ponder2010current}

\section*{Charge Transfer}
Charge transfer is the most difficult of the terms in EDA to model. This is
because there is no classical analogue for charge transfer. One common approach to
capturing charge transfer is to use a simple exponential dependent on the distance
between atoms.\cite{rackers2021polarizable} This captures the main effect which is the
short-range exponential stabilization due to charge delocalization. Unfortunately,
many-body charge transfer is non-negligible and this effect will be completely
missed when using just exponentials. Another attempt is to essentially treat
charge transfer the same way as polarization and solve a set of induced dipole equations.\cite{das2019development,wang2023general}
This has the benefit that it can capture many-body charge transfer. One drawback of this
approach is that it does not actually allow for charge to flow between molecules
and therefore misses some of the salient physics. It is also ambiguous if the induced
dipoles relevant to CT should be treated as real dipoles and allowed to interact 
with permanent and induced multipoles. Perhaps a bigger problem is that
charge transfer can be an even larger contribution than polarization, especially at short range.
This means the charge transfer energy would be even more susceptible to
polarization catastrophes than ordinary polarization.

For all of these reasons, we introduce a new approach to describing charge transfer
which is enabled by the fact we allow for explicit charge rearrangements in our
description of polarization. Our charge transfer model includes both direct and
indirect energy contributions. The direct contributions allow for energetic stabilization
associated with both forward and backward charge transfer.
\begin{align}
  V^{CT}_{i\rightarrow j}&=a_{i\rightarrow j}^{CT}S_{ij}^\rho\\
  V^{CT}_{j\rightarrow i}&=a_{j\rightarrow i}^{CT}S_{ij}^\rho\\
  V^{CT}_{direct}&=\sum_{i<j}V^{CT}_{i\rightarrow j}+V^{CT}_{j\rightarrow i}
  \label{eq:ct_direct}
\end{align}

As shown in Eq. \ref{eq:ct_direct}, the forward and backward contributions to
charge transfer are directly proportional to the density overlap.
We take inspiration from perturbation theory which shows, roughly, that
the amount of charge transferred between two molecules is proportional to the
energy associated with forward and backward charge transfer.\cite{khaliullin2007unravelling,khaliullin2008analysis,khaliullin2009electron}
Therefore, we define the amount of charge transferred from $i$ to $j$, $\Delta Q^{CT}_{i\rightarrow j}$,
and from $j$ to $i$, $\Delta Q^{CT}_{j\rightarrow i}$, as
\begin{align}
  \Delta Q^{CT}_{i\rightarrow j}&=\frac{V^{CT}_{i\rightarrow j}}{\epsilon_{i\rightarrow j}}\\
  \Delta Q^{CT}_{j\rightarrow i}&=\frac{V^{CT}_{j\rightarrow i}}{\epsilon_{j\rightarrow i}}
\end{align}

The proportionality constant between direct charge transfer
energy and the amount of transferred charge is written as $\epsilon_{i\rightarrow j}$
to emphasize that this proportionality is related to the difference in energy
of an occupied orbital on $i$ and an unoccupied orbital on $j$.\cite{khaliullin2007unravelling}

This approach is novel by allowing charge to explicitly move between
fragments. This is achieved by modifying the molecular charge constraints used in Eq. \ref{eq:pol_mat}.
The charge constraint for a fragment $A$ will then take the form,
\begin{equation}
  Q^{CT}_A=Q_A+\sum_{i\in A}\sum_{j\notin A}\Delta Q^{CT}_{j\rightarrow i}-\Delta Q^{CT}_{i\rightarrow j}
  \label{eq:charge_constraint}
\end{equation}
The charge constraint including charge transfer, $Q^{CT}_A$, is simply the
difference in charge transferred to atom $i$ (in $A$) and charge transferred from atom
$i$, summed over all atoms in molecule $A$. These charges will not be optimally
distributed, so they will be allowed to relax during the polarization process.
This allows us to capture the so-called "re-polarization"\cite{khaliullin2007unravelling}
effect in which orbitals relax after allowing for occupied-virtual mixing.
For example, when charge is transferred from oxygen to hydrogen in a water
dimer, the final excess charge will mostly come to rest on the oxygen in
the water with net-negative charge.

The major non-additivity in this charge transfer model comes from
the energy penalty associated with any atoms having nonzero values of $\delta q$.
This is consistent with two known effects that distinguish the stability of water clusters.
First, homodromic rings have particularly large non-additivities.\cite{xantheas2000cooperativity}
In our model, this type of ring benefits from many-body charge transfer since each molecule
can pass its excess charge along to the next molecule, resulting in a minor excess charge penalty.
Second, this model makes it clear why water molecules which accept two hydrogen bonds without
donating any hydrogen bonds are particularly unstable.\cite{kirov2008identifying} That is, charge
gets transferred out of the double acceptor molecule and every molecule gets
stuck with nonzero total charges. Figure 1(a) illustrates the additional stabilization
experienced by homodromic rings due to being able to pass along excess charge. Figure 1(b)
shows why double acceptor water molecules are particularly unstable.

\textbf{Consider moving this into some results section later on...}



There is one technical point worth noting about this model. Because the
charge transferred between fragments is proportional to the direct CT contributions,
the charge constraints depend on the distance between atoms. This means there
is a gradient contribution which multiplies the lagrange multipliers
with the gradient of $\Delta Q^{CT}_{i\rightarrow j}$ and $\Delta Q^{CT}_{j\rightarrow i}$.
This is not difficult or expensive to evaluate, but because it is a rather
unusual gradient term, we wanted to point this out clearly.

\section*{Reference Data}

Our model is parameterized using water clusters of size \ce{(H_2O)_n} with n=2-5.
We use 2400 dimers, trimers, tetramers, and pentamers extracted from various minimized
cluster geometries. We additionally generated 4800 psuedo-random water dimers using
based on a Sobol sequence. We follow exactly the same procedure as described elsewhere.\cite{misquitta2008first}
Using the same procedure we generated 4800 ion-water dimer geometries for all ion species considered in this study,
namely \ce{F^-}, \ce{Cl^-}, \ce{Br^-}, \ce{I^-}, \ce{Li^+}, \ce{Na^+}, \ce{K^+}, \ce{Rb^+}, \ce{Cs^+}, \ce{Mg^{2+}}, and \ce{Ca^{2+}}.

\section*{Parameterization}

%The last important point in this model concerns the determination of the
%atomic width, $b_i$. We utilize the implementation of the ISA model of
%Misquitta\cite{misquitta2014distributed} available in CamCASP\cite{misquitta2016ab}
%to obtain these parameters from monomer electron densities.

\section*{Results and discussion}

\input{tables/mae_table.tex}

\begin{figure}
  \includegraphics*[width=\textwidth]{figures/trimer_mbe_example.png}
  \caption{Two water trimers illustrating the importance of both polarization
  and charge transfer for the stability of water molecules. FRZ corresponds to
  the frozen contribution: the sum of Pauli, electrostatic, and dispersion enegies. POL is the polarization
  energy and CT is the charge transfer energy. Energies are computed at the
  $\omega$B97X-V/def2-QZVPPD level of theory. See text for discussion.}
\end{figure}

\begin{acknowledgement}

TODO

\end{acknowledgement}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% The same is true for Supporting Information, which should use the
%% suppinfo environment.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{suppinfo}

TODO

\end{suppinfo}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% The appropriate \bibliography command should be placed here.
%% Notice that the class file automatically sets \bibliographystyle
%% and also names the section correctly.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\bibliography{references}
\end{document}