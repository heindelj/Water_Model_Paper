%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% This is a (brief) model paper using the achemso class
%% The document class accepts keyval options, which should include
%% the target journal and optionally the manuscript type. 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\documentclass[journal=jacsat,manuscript=article]{achemso}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Place any additional packages needed here.  Only include packages
%% which are essential, to avoid problems later. Do NOT use any
%% packages which require e-TeX (for example etoolbox): the e-TeX
%% extensions are not currently available on the ACS conversion
%% servers.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage[version=3]{mhchem} % Formula subscripts using \ce{}
\usepackage{bm}
\usepackage{xcolor}
\usepackage{dsfont}
\usepackage{pdflscape}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% If issues arise when submitting your manuscript, you may want to
%% un-comment the next line.  This provides information on the
%% version of every file you have used.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%\listfiles

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Place any additional macros here.  Please use \newcommand* where
%% possible, and avoid layout-changing macros (which are not used
%% when typesetting).
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcommand*\mycommand[1]{\texttt{\emph{#1}}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Meta-data block
%% ---------------
%% Each author should be given as a separate \author command.
%%
%% Corresponding authors should have an e-mail given after the author
%% name as an \email command. Phone and fax numbers can be given
%% using \phone and \fax, respectively; this information is optional.
%%
%% The affiliation of authors is given after the authors; each
%% \affiliation command applies to all preceding authors not already
%% assigned an affiliation.
%%
%% The affiliation takes an option argument for the short name.  This
%% will typically be something like "University of Somewhere".
%%
%% The \altaffiliation macro should be used for new address, etc.
%% On the other hand, \alsoaffiliation is used on a per author basis
%% when authors are associated with multiple institutions.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\author{Joseph P. Heindel}
\affiliation[Berkeley]
{Kenneth S. Pitzer Theory Center and Department of Chemistry, University of California, Berkeley, California94720, United States}
\alsoaffiliation[LBL]
{Chemical Sciences Division, Lawrence Berkeley National Laboratory, Berkeley, California94720, United States}
\author{Selim Sami}
\affiliation[Berkeley]
{Kenneth S. Pitzer Theory Center and Department of Chemistry, University of California, Berkeley, California94720, United States}
\author{Teresa Head-Gordon}
\email{thg@berkeley.edu}
\affiliation[Berkeley]
{Kenneth S. Pitzer Theory Center and Department of Chemistry, University of California, Berkeley, California94720, United States}
\alsoaffiliation[LBL]
{Chemical Sciences Division, Lawrence Berkeley National Laboratory, Berkeley, California94720, United States}
\alsoaffiliation[Berkeley2]
{Departments of Bioengineering and Chemical and Biomolecular EngineeringUniversity of California, Berkeley, California94720, United States}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% The document title should be given as usual. Some journals require
%% a running title from the author: this should be supplied as an
%% optional argument to \title.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\title[An \textsf{achemso} demo]
  {Construction of Accurate Force Fields from Energy Decomposition Analysis: Water and Ions}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Some journals require a list of abbreviations or keywords to be
%% supplied. These should be set up here, and will be printed after
%% the title and author information, if needed.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\keywords{American Chemical Society, \LaTeX}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% The manuscript does not need to include \maketitle, which is
%% executed automatically.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% The "tocentry" environment can be used to create an entry for the
%% graphical table of contents. It is given here as some journals
%% require that it is printed as part of the abstract page. It will
%% be automatically moved as appropriate.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{tocentry}

Some journals require a graphical entry for the Table of Contents.
This should be laid out ``print ready'' so that the sizing of the
text is correct.

Inside the \texttt{tocentry} environment, the font used is Helvetica
8\,pt, as required by \emph{Journal of the American Chemical
Society}.

The surrounding frame is 9\,cm by 3.5\,cm, which is the maximum
permitted for  \emph{Journal of the American Chemical Society}
graphical table of content entries. The box will not resize if the
content is too big: instead it will overflow the edge of the box.

This box and the associated title will always be printed on a
separate page at the end of the document.

\end{tocentry}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% The abstract environment will automatically gobble the contents
%% if an abstract is not used by the target journal.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{abstract}
This work describes a force field for water and atomic ions which aims to quantitaively
reproduce each term of an energy decomposition analysis. In the model, polarization
is handled in a manner that allows for charge fluctuations and induced dipoles.
The model contains a new approach to modelling charge transfer which allows for
explicit movement of charge between molecules. We show that this approach naturally
describes many-body charge transfer by coupling into the polarization equations.
Additionally, we highlight the fact that many-body charge transfer is non-negligible in aqueous systems.
\color{red}{More here...}
\end{abstract}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Start the main part of the manuscript here.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Introduction}
Historically, there have been two main approaches to including
polarization in force fields: fluctuating charges\cite{rick1994dynamical}
or induced dipoles\cite{applequist1985multipole}. There have also been
attempts to unify these approaches allowing for both charge rearrangements
and induced dipoles.\cite{stern2001combined} The original justification for
including fluctuating charges in polarizable force fields was to
capture the charge transfer interaction.\cite{rick1994dynamical} With the advent
of variational energy decomposition analysis (EDA) techniques\cite{horn2016probing,mao2021intermolecular},
it is now clear that the charge transfer energy scales exponentially and hence
cannot be modelled by fluctuating charges alone.

Our goal in this paper is to develop a new class of polarizable
force field which is able to quantitatively reproduce all of the terms
in an energy decomposition analysis (EDA)\cite{horn2016probing,mao2021intermolecular},
including their many-body contributions. The reason to do this
is that by reproducing the EDA term-by-term, we can ensure that the force
field will be transferable across the phase diagram of a homogeneous
system and, ideally, to new heterogenous systems.
Additionally, by reproducing the EDA term-by-term, the force field
is able to provide insights which many other models simply cannot because
they do not include particular terms. For instance, many force fields
do not include charge transfer or charge penetrations terms.
Many force fields also use terms which package the Pauli repulsion and dispersion 
energies together. We will discuss this further in the results section,
but making such approximations limits the interpretability and accuracy of the
energies and forces predicted by a force field. Even worse, one can only
exclude charge transfer and charge penetration from force fields because
these energies are strongly correlated to the Pauli repulsion (see Fig. \ref{fig:cp_ct_pauli}).
This correlation is not guaranteed to be consistent between systems, however,
which may explain part of the historical difficulty in producing water models which
generalize to heterogeneous systems.

It has been appreciated for a long time that non-additive interactions are
important for describing hydrogen-bonded interactions such as those in water.\cite{xantheas2000cooperativity}
The importance of many-body contributions for water interacting with ions have
also been studied extensively and are found to be quite large (typically around 15\% of the binding energy)
and can be either stabilizing or destabilizing.\cite{heindel2021many,herman2021many}
These observations have been made by computing the many-body expansion (MBE) of
the binding energy\cite{heindel2020many}, which means one gains insights into how much non-additivity
is relevant to the system, but not which interactions that non-additivity can be
attributed to. The primary source of non-additivities in most polarizable force fields
is simply the electric polarization. While this is the main source of non-additive
interactions for aqueous systems, we will show that many-body contributions to charge
transfer are also quite important. To that end, we develop a model which is capable
of describing many-body charge transfer very accurately at only a small additional
computational cost compared to a similar polarizable force field.

The construction of force fields capable of accurately modelling both water and
its interaction with ions is an open problem dating back decades. The most recent
progress, arguably, has been made by explicitly fitting the terms of the MBE for
ion-water interactions.\cite{zhuang2022hydration,caruso2022accurate} This approach
has the drawback that generalizing the procedure to multi-component systems,
such as a solution containing multiple types of ions, is made difficult by
the combinatorial explosion of terms which need to be fit.

Even today, many simulations involving ions or ionized molecules are carried out by treating the
ion as a scaled charge with simple functional forms for dispersion and repulsion.\cite{leontyev2011accounting,bedrov2019molecular}
To a large extent, there simply are not good alternatives since most polarizable
models of water and monoatomic ions leave much to be desired in both accuracy and
numerical stability. This work takes a large step forwards in the construction of
polarizable force fields capable of handling very strong interactions such as those
between water and ions.

\section{Theory}
EDA splits the interaction energy into five components: Pauli repulsion,
electrostatics, dispersion, polarization, and charge transfer. The force
field described in this work will model each of these term by term.
Note that we will use a convention of referring to all energy
terms in the force field with a $V$ and all energy terms from electronic structre
with an $E$.

Our approach borrows ideas from the density overlap hypothesis\cite{kim1981dependence,wheatley1990overlap,gavezzotti2002calculation,van2016beyond,van2018new}
which states that the short-range contributions to intermolecular
interactions is proportional to the electron density overlap. In order
for this idea to be amenable to force fields, one must use atom-centered
density overlaps. One way of doing this was developed thoroughly by
Misquitta and others\cite{misquitta2014distributed,misquitta2018isa} based
on iterated stockholder atoms which can be used to define Slater-like
densities for atoms in molecules. Very similar ideas have been developed
by Rackers \textit{et al.}\cite{rackers2021polarizable} for the HIPPO force field
as well as van Vleet \textit{et al.} in the MASTIFF force field.\cite{van2016beyond,van2018new} 
We will make reference to the differences between the various approaches as relevant.
In any case, since the use of a model density in a force field has been discussed extensivly,
we will only summarize the salient points here.

The form of the charge density used in the model is,
\begin{equation}
  \rho(r)=\frac{Qb^3}{8\pi}e^{-br}+Z\delta(r)
  \label{eq:slater}
\end{equation}
\noindent
where $Q$ is the charge associated with the model electron density,
$Z$ is the effective nuclear charge of the atom, and $b$ defines the width
of the Slater density. The delta function, $\delta(r)$, means the core is
treated as a point particle.

One can show that the overlap, $S_{ii}^\rho$, of two identical Slater-like atomic densities
at different locations, $\rho_i(\bm{r}_i)$ and $\rho_i(\bm{r}_j)$, is,
\begin{equation}
  S_{ii}^\rho=\frac{\pi D^2}{b_{ii}^3}P(b_{ii}r_{ij})\exp(-b_{ii}r_{ij})
\end{equation}
The above overlap expression is only strictly true for the exponential tail
of the Slater density and for identical atoms. The overlap between atoms
with different densities, $S^{ij}_\rho$, has a more complicated form, but
it has been shown that setting $b_{ij}=\sqrt{b_ib_j}$ allows the expression
for $S_{ii}^\rho$ to be used for different atom types to a good
approximation\cite{van2016beyond}. The polynomial prefactor in the overlap is,
\begin{equation}
  P(b_{ij}r_{ij})=\frac13(b_{ij}r_{ij})^2 + b_{ij}r_{ij}+1
\end{equation}
where, again, we will use the combination rule $b_{ij}=\sqrt{b_ib_j}$.

Rackers \textit{et al.} utilize a similar idea in the HIPPO model\cite{rackers2021polarizable}
but rather than relying on density overlap, they treat the Slater function as an
orbital and are able to derive models of Pauli repulsion, charge penetration, and
even dispersion. Because HIPPO is derived from a model orbital, the damping functions
which prevent singularities in various short-range energetic contributions arise naturally.
We find the HIPPO approach to both Pauli repulsion and electrostatics to be physically principled
and utilize them here without significant modification.

We utilize both Slater density overlap and Slater orbital overlap in different terms within
the model. It is important to realize that either approach really just provides a
physically meaningful indication of what is "short-range" for a pair of atoms. Therefore,
combining the idea of overlapping Slater densities with overlapping Slater orbitals seems
natural to us.

\subsection*{Deformation Energy}

The deformation energy for our water model is constructed following a protocol we have
recently published (\textbf{REF WHEN AVAILABLE}). The one-body potential consists of a
morse potential, cosine angle potential, a bond-bond coupling term, and bond-angle coupling
term. The parameters are fit to reproduce the CCSD(T)/aug-cc-pV5Z hessian at the
corresponding eeuqilibrium geometry. Note that this is the only term where we do not
use $\omega$B97X-V/def2-QZVPPD as a reference simply because CCSD(T)/aug-cc-pV5Z is a
bit closer to the experimental geometry. To be explicit, the morse potential is,
\begin{align}
  \label{eq:morse}
  V_{bond}&=D_{\mathrm{OH}}\left[ 1-\exp(-\alpha (R-R_e))\right]^2 \\
  \label{eq:angle}
  V_{angle}&=\frac{k_a}{2}(\cos\theta-\cos\theta_e)^2 \\
  \label{eq:bond_bond}
  V_{bb}&=k_{bb}(R_1-R_e)(R_2-R_e) \\
  \label{eq:bond_angle}
  V_{ba}&=k_{ba}(R-R_e)(\cos\theta-\cos\theta_e)
\end{align}

In Eq. \ref{eq:morse}, $D_{\mathrm{OH}}$ is the dissociation energy of
the \ce{O-H} bond in water, $R_e$ is the equilibrium bond length in water,
and $\alpha=\sqrt{k_e/2D}$ determines the curvature of the potential as is
evident from the fact it is written in terms of the harmonic force constant, $k_e$.
The two \ce{O-H} stretches in water are coupled linearly in Eq. \ref{eq:bond_bond}
via a single bond-coupling parameter, $k_{bb}$.

The angle potential is harmonic in $\cos\theta$ where $\theta$ is the \ce{HOH} angle
and $\theta_e$ is the equilbrium angle in water, as seen in Eq. \ref{eq:angle}.
Eq. \ref{eq:bond_angle} shows that the angle and bond potentials are linearly
coupled by a single parameter, $k_{ba}$.

As will be explained later, we learned that
it is essential to allow bonding parameters to respond to the local environment to reproduce
the well-known structure-frequency correspondence in water.\cite{boyer2019beyond} We do this
by modifying Eq. \ref{eq:morse} to be field-dependent. Specifically, the bond force constant, $k_e$,
and equilibrium bond length, $R_e$, are coupled to the electric field projected along the bond, $\mathrm{E_{OH}}$,
via the first and second dipole derivatives, $\mu^{(1)}$ and $\mu^{(2)}$. These derivatives
are treated as parameters which we compute from electronic structure. The equilbrium bond
length, $R_e$, becomes
\begin{equation}
  R_e(\mathrm{E_{OH}})=R_e^0+ \frac{\mathrm{E_{OH}}\mu^{(1)}}{k_e^0-\mathrm{E_{OH}}\mu^{(2)}}
  \label{eq:bond_in_field}
\end{equation}

In the above, $R_e^0$, is the equilibrium bond length under zero field and $k_e^0$ is
force constant under zero field. The force constant under a nonzero field, $k_e(\mathrm{E_{OH}})$, is,
\begin{equation}
  k_e(\mathrm{E_{OH}})=k_e^0-3k_e^0\alpha\left(R_e(\mathrm{E_{OH}})-R_e^0\right)-\mathrm{E_{OH}}\mu^{(2)}
  \label{eq:force_constant_in_field}
\end{equation}

We see in Eq. \ref{eq:force_constant_in_field} that the change in the force constant in a field depends
on the magnitude of the change in bond length due to that field. In this sense, the field-dependent
morse potential guarantees the structure-frequency correlation will be respected at least approximately.
It is only somewhat clear from the equations, but we find that the first dipole derivative
primarily controls the bond length and the second dipole derivative primarily controls the frequency.
These equations can be derived by analyzing the behavior of a morse potential in an electric field.\cite{boyer2019beyond}


\subsection*{Electrostatics}

Our description of electrostatics comes from a traditional
point multipole approach and a charge penetration contribution. We will refer to
these contributions as the DMA energy and CP energy, respectively.
Our working definition of charge penetration comes by taking the
classical electrostatic energy from EDA minus the interaction energy
when using Stone's distributed multipole analysis\cite{stone1981distributed,stone1985distributeda}
out to hexadecapoles on all atoms.

\begin{equation}
  E^{CP}=E^{elec}_{EDA}-E^{elec}_{DMA}
  \label{eq:cp}
\end{equation}

The advantage of this approach is it allows us to ensure that
our multipoles are not biased to compensate for error in the
description of charge penetration, which is essential to reproduce
the classical electrostatic energy in EDA.
All distributed multipole calculations were carried out
in Stone's Orient program.\cite{stone2002orient}

Charge penetration is described by treating each atom as having both a positively
charged core and negatively charged shell. We use the same set of damping functions
as derived by Rackers and Ponder which are appropriate for the Slater density in Eq. \ref{eq:slater}.\cite{rackers2021polarizable}
Very similar models have been applied successfully in MB-UCB\cite{das2019development}
based on functional forms proposed by Piquemal\cite{piquemal2003improved} and others\cite{wang2015general,rackers2017optimized}.

Considering the interactions of the collection of cores and shells, which are expanded in multipoles,
results in the following electrostatic energy expression:

\begin{equation}
  V_{elec}=\sum_{i<j}Z_iT_{ij}Z_j+Z_i\bm{T}_{ij}^{damp}\bm{M}_j+Z_j\bm{T}_{ji}^{damp}\bm{M}_i+\bm{M}_i\bm{T}_{ij}^{overlap}\bm{M}_j
  \label{eq:elec}
\end{equation}
\noindent
In eq. \ref{eq:elec}, the first term represents repulsive core-core interactions where $T_{ij}=1/r_{ij}$
with $Z_i$ the core charge on the $i$th atom. Note that this is not the nuclear charge but an effective
nuclear charge. The second and third terms describe attractive core-shell interactions where $\bm{M}_i$ is
a vector whose entries are the components of the multipoles located on that atom. We allow all atoms to have
multipoles up to the quadrupole. Note that the core-shell interactions are damped according to
\begin{equation}
  \bm{T}_{ij}^{damp}=
  \begin{bmatrix}
    1 & \nabla & \nabla^2 \\
  \end{bmatrix}\cdot
  \left(\frac{1}{r_{ij}}f_{ij}^{damp}(r_{ij})\right)
  \label{eq:T_damp}
\end{equation}
\noindent
The shell-shell interactions are damped, albeit with a different damping function,
and the corresponding interaction tensor is written as:
\begin{equation}
  \bm{T}_{ij}^{overlap}=
  \begin{bmatrix}
    1 & \nabla & \nabla^2 \\
    \nabla & \nabla^2 & \nabla^3 \\
    \nabla^2 & \nabla^3 & \nabla^4 \\
  \end{bmatrix}\cdot
  \left(\frac{1}{r_{ij}}f_{ij}^{overlap}(r_{ij})\right)
  \label{eq:T_overlap}
\end{equation}
\noindent
The damping functions $f_{ij}^{damp}(r_{ij})$ and $f_{ij}^{overlap}(r_{ij})$ 
take the following forms.

\begin{subequations}
  \begin{equation}
    f_{ij}^{damp}(r_{ij})=1-\left(1+\frac12b_{j}r_{ij}\right)e^{-b_{j}r_{ij}}
    \label{eq:damp_a}
  \end{equation}
  \begin{equation}
    f_{ij}^{overlap}(r_{ij})=1-\left(1+\frac{11}{16}b_{ij}r_{ij}+\frac{3}{16}(b_{ij}r_{ij})^2+\frac{1}{48}(b_{ij}r_{ij})^3\right)e^{-b_{ij}r_{ij}} 
    \label{eq:damp_b}
  \end{equation}
\end{subequations}
\noindent
Simply comparing the forms of Eq. \ref{eq:damp_a} with Eq. \ref{eq:damp_b} makes it clear
why the core-shell model of charge penetration works. Namely, as long as $b_j$ is similar
to $b_{ij}$, which it almost always will be, then the polynomial in Eq. \ref{eq:damp_b} will
be larger than that in Eq. \ref{eq:damp_a}. This means the overlap damping function is stronger
and hence the shell-shell repulsions will be damped more strongly than the core-shell
attractions. Therefore, at short-range the electrostatic energy will be more attractive than a
point multipole expansion of the density would suggest, which is exactly what is meant by
charge penetration.

The damping function in Eq. \ref{eq:damp_a} can be derived directly from the form
of the Slater density in Eq. \ref{eq:slater} by computing its electrostatic potential.
The damping function in Eq. \ref{eq:damp_b} can be derived from a symmetrized coulomb integral where each
density interacts with the damped potential generated by the other density.\cite{rackers2021polarizable}
Finally, it is important to note that these damping functions are the ones which apply
to charge-charge interactions and that as higher-order multipoles are considered, new damping
functions are generated alongside the gradients of $1/r_{ij}$. In other words, every interaction
tensor in the multipole expansion will be damped differently. The form of all relevant damping
functions have been derived and summarized elsewhere.\cite{rackers2021polarizable}

\section*{Polarization}

We introduce a combined fluctuating charge (FQ) and induced dipole model of electronic
polarization. There are two reasons we have pursued this combined polarization
approach. The first is quite simple: we want to reproduce all terms from EDA,
one of which is charge transfer. If charges are not allowed to vary, then one
cannot model the explicit transfer of charge between molecules. The second reason is
that atomic polarizabilities naturally contain both charge-flow and induced dipole
contributions.\cite{stone1985distributedb} Typically, the charge-flow contributions
are localized away\cite{ruth1994localization}, but our approach does not require nonlocal
charge flow polarizabilities.

The FQ contribution to our polarization model is a modification of the electronegativity
equalization model (EEM) of polarization.\cite{mortier1986electronegativity} In EEM,
the energy of a molecule is expanded to second-order as a function of charge while allowing
all charges to interact. Mathematically, this takes the following form,
\begin{equation}
  V(\bm{q})=\sum_i \chi_i q_i + \frac12 \sum_i \eta_i q_i^2 + \sum_{i<j} \frac{q_i q_j}{r_{ij}}
  \label{eq:eem}
\end{equation}

In Eq. \ref{eq:eem}, $\chi_i$ represents the electronegativity of atom $i$ and
$\eta_i$ is the atomic hardness of atom $i$. The principle of electronegativity
equalization states that  at equilibrium, the electronegativity of all atoms
will become equal. This allows the charges in an atom to be determined by solving
a system of linear equations. There are several known shortcomings of EEM. The first
is the long-range transfer of charge between molecules, even at infinite distance,
which is unrealistic for the dielectric systems studied here.\cite{chen2007qtpie,chen2008unified}
Our solution to this problem is to only allow charge rearrangements within
a molecule and not between molecules. This constraint can be introduced using
Lagrange multipliers. A second limitation of EEM is that the approach in Eq. \ref{eq:eem}
gives back the total charge of atoms in a molecule. This is somewhat awkward because
we want to separate the multipolar electrostatics, which depends on the total charge,
from the polarization contribution which should only depend on the external potential
and field experienced by each atom. Hence, we drop the linear term and focus only on the
fluctuation of charges around the reference charge used for permanent electrostatics.
Another way of viewing this is that we are equalizing electronegativity around an "already
equalized" state. The change in electronegativity at each atom due to an environment is simply
the electric potential at that atom. We can then write the FQ contribution in our
model as,
\begin{equation}
  V(\delta \bm{q})=\frac12\sum_i \eta_i \delta q_i^2 + \sum_i \delta q_i V_i + \sum_{i<j}\frac{\delta q_i \delta q_j}{r_{ij}} + \sum_{\alpha}\lambda_\alpha \sum_{i\in\alpha}\delta q_{i}
  \label{eq:fq}
\end{equation}

To summarize, Eq. \ref{eq:fq} allows charges to rearrange, $\delta q_i$, in response to an external
potential, $V_i$, with a quadratic penalty determined by the atomic hardness, $\eta_i$.
The charge rearrangements are constrained to only occur between atoms such that rearranged
charges in a molecule sum to the total charge of a molecule. Therefore, the model has $N$ lagrange
multipliers, $\lambda_\alpha$, where $N$ is the number of molecules in the system. These molecules
could be water or an ion in this work. Note that all fluctuating charges (and induced
dipoles) are allowed to interact whether they are in the same molecule or not.

We also allow electric fields due to the environment to induce dipoles on all atoms.
The energy of an induced dipole in an electric field, $\bm{E}$, including mutual polarization is,
\begin{equation}
  V(\bm{\mu}^{ind})=-\frac12\sum_i \bm{\mu}_i^{ind}\cdot \bm{E}_i^{damp} + \sum_{i<j}\bm{\mu}^{ind}_i \bm{T}^{\mu\mu}_{ij}\bm{\mu}^{ind}_j
  \label{eq:induced_dipoles}
\end{equation}

In Eq. \ref{eq:induced_dipoles}, the induced dipoles at each polarizable site, $\bm{\mu}_i^{ind}$,
interact with an external electric field, $\bm{E}_i^{damp}$, and with each other via the dipole interaction tensor.
The field $\bm{E}_i^{damp}$ is the damped electric field generated by a Slater density
and $\bm{T}^{\mu\mu}_{ij}$ is the damped dipole-dipole interaction tensor which is derived from appropriate
gradients of $f_{ij}^{overlap}/r_{ij}$.

What now remains is to determine the values of $\delta \bm{q}$ and $\bm{\mu}^{ind}$
which minimize the total energy of the system. In order to do this, we take
the derivative with respect to each $\delta q_i$ and each component of each
$\bm{\mu}_i^{ind}$ and set them all equal to zero. This results in a system of linear
equations which can be written succintly as follows:


\begin{equation}
  \begin{pmatrix}
    \bm{T}^{qq} & \bm{1}_\lambda & \bm{T}^{q\mu} \\
    \bm{1}_\lambda^\dagger & 0 & 0 \\
    -\bm{T}^{\mu q} & 0 & \bm{T}^{\mu\mu} \\
  \end{pmatrix}
  \begin{pmatrix}
    \delta \bm{q} \\
    \bm{\lambda} \\
    \bm{\mu} \\
  \end{pmatrix}
  =
  \begin{pmatrix}
    -\bm{V} \\
    \bm{Q} \\
    \bm{E} \\
  \end{pmatrix}
  \label{eq:pol_mat}
\end{equation}

The solution vector in Eq. \ref{eq:pol_mat} contains the electric potential,
$\bm{V}$, the total charges of each molecule, $\bm{Q}$, and the electric
field on each atom $\bm{E}$. The matrix has several blocks containing the
charge-charge ($\bm{T}^{qq}$), charge-dipole ($\bm{T}^{q\mu}$),
dipole-charge ($\bm{T}^{\mu q}$), and dipole-dipole interaction tensors ($\bm{T}^{\mu\mu}$).
Note that the diagonal elements of $\bm{T}^{qq}$ are the atomic hardness $\eta$ and
the $3\times 3$ diagonal blocks of $\bm{T}^{\mu\mu}$ are the inverse polarizability tensor
$\bm{\alpha}_i^{-1}$. The block $\bm{1}_\lambda$ has a column for each molecule in the system.
An entry in that column is 1 if the $i$th atom is in that molecule and zero otherwise.
These blocks enforce the charge-conservation constraints for each molecule.
Finally, $\delta\bm{q}$ contains the optimally rearranged charges, $\bm{\lambda}$ contains
the Lagrange multipliers which enforce charge conservation, and $\bm{\mu}$ are the induced dipoles.

The form of the $ij$ entries of the multipole interaction tensors are as follows:
\begin{subequations}
  \begin{equation}
    T^{qq}_{ij}=f_1^{overlap}\frac{1}{r_{ij}}
    \label{eq:tensors_a}
  \end{equation}
  \begin{equation}
  \bm{T}^{q\mu}_{ij}=f_3^{overlap}\frac{-\bm{r}_{ij}}{r_{ij}^3}
    \label{eq:tensors_b}
  \end{equation}
  \begin{equation}
  \bm{T}^{\mu\mu}_{ij}=\left(f_5^{overlap}\frac{\bm{r}_{ij}\otimes\bm{r}_{ij}}{r_{ij}^5}-f_3^{overlap}\frac{\bm{1}}{r_{ij}^3}\right)
    \label{eq:tensors_c}
  \end{equation}
  \label{eq:tensors}
\end{subequations}

The interaction tensors in Eq. \ref{eq:tensors} are the usual cartesian multipole interaction
tensors, generated by successive gradients of $1/r_{ij}$ where $r_{ij}$ is the distance between
two atoms. These tensors are multiplied by the overlap damping function derived from the overlap
of two slater pseudo-orbitals\cite{rackers2021polarizable}.
As an aside, the damping functions generated by the usual Thole damping procedure\cite{thole1981molecular},
are exponentials multiplied by first-, second-, and third-order polynomials
for charge-charge, charge-dipole, and dipole-dipole interactions, respectively.\cite{thole1981molecular}
These polynomials are smaller than the scaling of mutual polarization, which is roughly the square
of a similar permanent multipole interaction. That is, the field due to a permanent dipole
decays as $r_{ij}^{-3}$. The dipole induced by this field interacts with other induced dipoles
with an energy that is proportional to the magnitude of the induced dipole and via a field
that decays as $r_{ij}^{-3}$. Since the magnitude of an induced dipole is proportional to
the permanent applied field, this means mutual polarization of induced dipoles decays as roughly $r_{ij}^{-6}$.
The damping functions generated from the overlap of slater orbitals are
third-, fourth-, and fifth-order polynmials multiplied by an exponential for charge-charge, charge-dipole,
and dipole-dipole interactions, respectively. These damping functions are therefore better able
to control the polarization energy than the Thole damping functions used in other force fields.
In fact, the small orders of the polynomials in Thole damping likely explain much of the historic difficulty of controlling
polarization between ions and water.\cite{jiao2006simulation,mason2012accurate}

Normally, the dipole polarizability is treated as a constant in polarizable force fields,
but Chung \textit{et al.} have pointed out that the polarizability of ions
is significantly diminished in the aqueous phase.\cite{chung2022classical}
This effect is not exclusive to ions, but is simply more noticable for diffuse anions. We adopt a slightly
simplified version of the scheme suggested by Chung \textit{et al.} for making the polarizability dependent on the local
environment. We damp the inverse polarizability, $\bm{\alpha}^{-1}$, as follows
\begin{equation}
  \bm{\alpha}^{-1}_i=
  R_i\begin{pmatrix}
    \alpha^{-1}_{xx,i} & 0 & 0 \\
    0 & \alpha^{-1}_{yy,i} & 0 \\
    0 & 0 & \alpha^{-1}_{zz,i} \\
  \end{pmatrix}R_i^T
    +\mathds{1}\sum_{j}k^{damp}_{i}\left(\frac{\bar{\alpha}_i\bar{\alpha}_j}{r_{ij}^6}\right)
    \label{eq:polarizability}
\end{equation}
\noindent
The first term in Eq. \ref{eq:polarizability} is a typical expression of the dipole polarizability
in the local axis frame of that atom. $\alpha_{xx,i}$ is the $xx$ component of the dipole polarizability
with other entries defined analogously. $R_i$ is the rotation matrix that transforms the local
axis system of atom $i$ to the global axis system. The second term defines an environment-dependent
isotropic damping of the polarizability. We use the dimensionless length scale, $\frac{\bar{\alpha}_i\bar{\alpha}_j}{r_{ij}^6}$,
to indicate when damping should become important. $\bar{\alpha}_i$ is the mean dipole polarizability of atom $i$.
$k_{i}^{damp}$ is an atom-specific parameter which modulates the increase of the inverse polarizability.

Note that this modification of the polarizability describes a completely different
effect from the damping of induced electrostatics. In the case of multipolar interactions,
the damping arises from the fact that real charge densities have a finite width. The effect
modelled in Eq. \ref{eq:polarizability} is the shrinking of atoms which occurs due to
antisymmetrization of the wavefunction. The effect is most important for very diffuse atoms, such as \ce{I^-},
or for very close contacts such as the interaction of \ce{Li^+} with \ce{H2O}.

Most polarizable force fields include intramolecular polarization by allowing the induced
dipoles to interact regardless of whether they are in the same molecule or not. In our
experience, this tends to result in worse agreement between the model and reference polarization
energies. This is not surprising given that multipoles located within a couple bond lengths
are too close to expect electrostatics to give a good representation of the relevant interactions.
There is no doubt, however, that intramolecular polarization should be considered in some way.
To that end, we include a field-dependence in our bonding potential. One can show that the effect of
an applied field on a morse potential is to update the equilibrium distance as follows,\cite{boyer2019beyond}

\begin{equation}
  R_e(E_\mathrm{OH})=R_e(0) + \frac{E_\mathrm{OH}\mu^{(1)}}{k_e-E_\mathrm{OH}\mu^{(2)}}
  \label{eq:bond_in_field}
\end{equation}
\noindent
That is to say, the equilibrium bond length is shifted by the field at the hydrogen atom projected along the
bond in question, $E_\mathrm{OH}$, and the magnitude of the shift is determined by the
first and second dipole derivatives, $\mu^{(1)}$ and $\mu^{(2)}$, also projected along the \ce{O-H} bond.
These derivatives are easily computed from electronic structure, so no free parameters are introduced here.
How to compute these derivatives will be explained in the parameterization section.
The force constant associated with the morse potential, $k_e$, must then also be updated
to correspond to the new equilibrium distance:
\begin{equation}
  k_e(E_\mathrm{OH})=k_e[1-3\alpha(R_e(E_\mathrm{OH})-R_e(0))]-E_\mathrm{OH}\mu^{(2)}
  \label{eq:ke_in_field}
\end{equation}
\noindent
Eq. \ref{eq:ke_in_field} is simply the second derivative of the morse potential evaluated
at the field-dependent equilibrium distance, Eq. \ref{eq:bond_in_field}. The updated force
constant is expressed in terms of the range parameter of the underlying morse potential, $\alpha$,
and the same field and dipole derivatives as described for Eq. \ref{eq:bond_in_field}.

Our experience is that describing intramolecular polarization by coupling it to the bond potential
makes the polarization energies more accurate and dramatically improves the underlying forces.
This term enables us to more accurately reproduce the expected correlation between bond length and
frequency which otherwise is impossible to capture accurately since the forces along an \ce{O-H}
bond will be systematically underestimated such that bond lengths do not elongate sufficiently.

Finally, there is one more term in our polarization model which is designed to only contribute at very
short range. Specifically, we introduce another term proportional to density overlap,
\begin{equation}
  V_{pol,sr}=\sum_{i<j}a_{ij}^{sr}f_4^{TT}(x_{ij})\left(\frac{1}{2}\frac{\bar{\alpha}_i + \bar{\alpha}_j}{r_{ij}^3}\right)^{4/3}S_{ij}^{\rho}
\label{eq:pol_sr}
\end{equation}
\noindent
While Eq. \ref{eq:pol_sr} is much more empirical than the rest of the force field,
it seems capture the effect of quadrupole polarization, which is known to be important
in water\cite{herman2023accurate} but is very computationally expensive for the magnitude of the effect.
In Eq. \ref{eq:pol_sr}, $\bar{\alpha}_i$ is the mean dipole polarizability of atom $i$, $f_4^{TT}(x_{ij})$
is the fourth-order Tang-Toennies damping function, defined later in Eq. \ref{eq:TT}, and $a_{ij}^{sr}=a_{i}^{sr}a_{j}^{sr}$ is
the pairwise parameter fit for this term. This term tends to have a magnitude for water
that is only a bit larger than what would one expect for quadrupole polarization (around 20\%). Eq. \ref{eq:pol_sr} is clearly
not a true model for quadrupole polarization since it is pairwise-additive
while quadrupole polarization would make small, nonzero many-body contributions. Similar terms
have been suggested before for capturing the short-range polarization of ions.\cite{sheng2022semiempirical}

\section*{Charge Transfer}
Charge transfer is the most difficult of the terms in EDA to model. This is
because there is no classical analogue for charge transfer. One common approach to
capturing charge transfer is to use a simple exponential dependent on the distance
between atoms.\cite{rackers2021polarizable} This captures the main effect which is the
short-range exponential stabilization due to charge delocalization. Unfortunately,
many-body charge transfer is non-negligible and this effect will be completely
missed when using just exponentials. Another attempt is to essentially treat
charge transfer the same way as polarization and solve a set of induced dipole equations.\cite{das2019development,wang2023general}
This has the benefit that it can capture many-body charge transfer. One drawback of this
approach is that it does not actually allow for charge to flow between molecules
and therefore misses some of the salient physics. It is also ambiguous if the induced
dipoles relevant to CT should be treated as real dipoles and allowed to interact 
with permanent and induced multipoles. Perhaps a bigger problem is that
charge transfer can be an even larger contribution than polarization, especially at short range.
This means the charge transfer energy would be even more susceptible to
polarization catastrophes than ordinary polarization.

For all of these reasons, we introduce a new approach to describing charge transfer
which is enabled by the fact we allow for explicit charge rearrangements in our
description of polarization. Our charge transfer model includes both direct and
indirect energy contributions. The direct contributions allow for energetic stabilization
associated with both forward and backward charge transfer.
\begin{subequations}
  \begin{equation}
  V^{CT}_{i\rightarrow j}=a_{i\rightarrow j}^{CT}S_{ij}^\rho
\end{equation}
\begin{equation}
  V^{CT}_{j\rightarrow i}=a_{j\rightarrow i}^{CT}S_{ij}^\rho
\end{equation}
\begin{equation}
  V^{CT}_{direct}=\sum_{i<j}V^{CT}_{i\rightarrow j}+V^{CT}_{j\rightarrow i}
\end{equation}
  \label{eq:ct_direct}
\end{subequations}

As shown in Eq. \ref{eq:ct_direct}, the forward and backward contributions to
charge transfer are directly proportional to the density overlap.
We take inspiration from perturbation theory which shows, roughly, that
the amount of charge transferred between two molecules is proportional to the
energy associated with forward and backward charge transfer.\cite{khaliullin2007unravelling,khaliullin2008analysis,khaliullin2009electron}
Therefore, we define the amount of charge transferred from $i$ to $j$, $\Delta Q^{CT}_{i\rightarrow j}$,
and from $j$ to $i$, $\Delta Q^{CT}_{j\rightarrow i}$, as
\begin{subequations}
  \begin{equation}
  \Delta Q^{CT}_{i\rightarrow j}=\frac{V^{CT}_{i\rightarrow j}}{\epsilon_{i\rightarrow j}}
\end{equation}
\begin{equation}
  \Delta Q^{CT}_{j\rightarrow i}=\frac{V^{CT}_{j\rightarrow i}}{\epsilon_{j\rightarrow i}}
\end{equation}
\end{subequations}

The proportionality constant between direct charge transfer
energy and the amount of transferred charge is written as $\epsilon_{i\rightarrow j}$
to emphasize that this proportionality is related to the difference in energy
of an occupied orbital on $i$ and an unoccupied orbital on $j$.\cite{khaliullin2007unravelling}

This approach is novel by allowing charge to explicitly move between
fragments. This is achieved by modifying the molecular charge constraints used in Eq. \ref{eq:pol_mat}.
The charge constraint for a fragment $A$ will then take the form,
\begin{equation}
  Q^{CT}_A=Q_A+\sum_{i\in A}\sum_{j\notin A}\Delta Q^{CT}_{j\rightarrow i}-\Delta Q^{CT}_{i\rightarrow j}
  \label{eq:charge_constraint}
\end{equation}
The charge constraint including charge transfer, $Q^{CT}_A$, is simply the
difference in charge transferred to atom $i$ (in $A$) and charge transferred from atom
$i$, summed over all atoms in molecule $A$. These charges will not be optimally
distributed, so they will be allowed to relax during the polarization process.
This allows us to capture the so-called "re-polarization"\cite{khaliullin2007unravelling}
effect in which orbitals relax after allowing for occupied-virtual mixing.
For example, when charge is transferred from oxygen to hydrogen in a water
dimer, the final excess charge will mostly come to rest on the oxygen in
the water with net-negative charge.

There is one technical point worth noting about this model. Because the
charge transferred between fragments is proportional to the direct CT contributions,
the charge constraints depend on the distance between atoms. This means there
is a gradient contribution which multiplies the lagrange multipliers
with the gradient of $\Delta Q^{CT}_{i\rightarrow j}$ and $\Delta Q^{CT}_{j\rightarrow i}$.
This is not difficult or expensive to evaluate, but because it is a rather
unusual gradient term, we wanted to point this out clearly.

\subsection*{Pauli Repulsion}
The original aim of the density overlap model was to model the
Pauli repulsion energy.\cite{wallqvist1989new,wheatley1990overlap,gordon1996approximate}
The density overlap model of Pauli repulsion results in a formally exponential
repulsion at short-range.
However, Rackers and Ponder have made a convinving argument that the appropriate
scaling of Pauli repulsion is actually of the form $E^{exch}\propto e^{-b_{ij}r_{ij}}/r_{ij}$.\cite{rackers2019classical,rackers2021polarizable}
While the exponential is the more important contribution, the factor of $1/r_{ij}$
becomes important at short distance and allows for the Pauli repulsion energy
to be expressed as a multipole expansion.

The multipolar pauli repulsion model has been discussed extensively elsewhere\cite{rackers2019classical}
so we only recapitulate the main points. The basic idea is that Pauli repulsion energy
between a pair of atoms is proportional to $S^2/r_{ij}$ where $S$ is the pseudo-orbital
overlap. The pseudo-orbital is defined as $\sqrt{\rho}$ where $\rho$ is the density in Eq. \ref{eq:slater}.

Therefore, the Pauli repulsion energy can be written as
\begin{equation}
  V_{Pauli}=\sum_{i<j}\frac{K_{ij}^q S^2_{q}+K_{ij}^\mu S^2_{\mu}+K_{ij}^\Theta S^2_{\Theta}}{r_{ij}}
\label{eq:pauli}
\end{equation}
\noindent
In Eq. \ref{eq:pauli}, $S^2$ represents the orbital overlap squared with different contributions
from charges, dipoles, and quadrupoles. This is critically important since Pauli repulsion
turns out to be highly anisotropic. However, producing parameters for a complete multipole expansion
tends to result in overfitting when there is not a way to derive the initial multipoles
from electronic structure. Therefore, the proportionality constants $K_{ij}=K_iK_j$ are fit instead.
Since $S^2$ takes the form of a damped multipole expansion\cite{rackers2019classical}, these proportionality
constants mean multipoles which handle repulsion are proportional to the actual electrostatic
multipoles. One nice thing about this approach is that the calculation of electrostatics and
multipolar Pauli repulsion differs only in the choice of damping function. Therefore, significant
computation can be shared between the two terms.

The expansion of Pauli repulsion in terms of multipoles has an interesting physical interpretation.
Namely, as two electron densities begin to overlap, the electrons will be expelled
from the internuclear region in order to keep the total system wavefunction antisymmetric.
This results in a "hole" in the electron density where nuclei are exposed to one another.
In a sense, then, these multipoles describe the magnitude and shape of the depletion of electron density
between two atoms which are near one another.

\section*{Dispersion}

The dispersion energy is the simplest term in the model. We use a damped
polynomial interaction given by,
\begin{equation}
  V_{disp}=\sum_{i<j}f_6^{TT}(x_{ij})\frac{C_{6,ij}}{r_{ij}^6}
  \label{eq:disp}
\end{equation}
\noindent
In Eq. \ref{eq:disp}, $C_{6,ij}$ is the dispersion coefficient between atoms
$i$ and $j$ which is determined as $C_{6,ij}=\sqrt{C_{6,i}C_{6,j}}$ and $C_{6,i}$ is
a parameter fit to the EDA dispersion energy. $f_6^{TT}(x_{ij})$ is the sixth-order
Tang-Toennies damping function\cite{tang1984improved} which was originally derived
to damp short-range dispersion,

\begin{equation}
  f_n^{TT}(x_{ij}) = 1-e^{-x_{ij}}\sum_{k=0}^n\frac{x_{ij}^k}{k!}
  \label{eq:TT}
\end{equation}

The appropriate form of $x$ for the tail of a Slater electron density
has been derived before\cite{van2016beyond} and takes the form,
\begin{equation}
  x_{ij}=b_{ij}r_{ij}-\frac{2b_{ij}^2r_{ij}^2+3b_{ij}r_{ij}}{b_{ij}^2r_{ij}^2+3b_{ij}r_{ij}+3}
  \label{eq:TT_x}
\end{equation}

Note that the TT damping functions, Eq. \ref{eq:TT}, depend parametrically on
the choice of integer $n$. In their original work, Tang and Toennies show that the appropriate choice
of $n$ for dispersion is $n=6$. This makes the damping function an exponential multiplied by a sixth order polynomial.
This polynomial is able to control the $r^{-6}$ scaling of dispersion, while the exponential ensures no
damping at long distances. As an aside, one could also use TT damping functions of different orders to control
mutual polarization. We have tested this and it works just as well as the procedure we
described of increasing the order of $f^{overlap}$.

\section*{Reference Data}

Our model is parameterized using water clusters of size \ce{(H_2O)_n} with n=2-5.
We use 2400 dimers, trimers, tetramers, and pentamers extracted from various minimized
cluster geometries. We additionally generated 4800 psuedo-random water dimers
based on a Sobol sequence. We follow exactly the same procedure as described elsewhere.\cite{misquitta2008first}
Using the same procedure we generated 4800 ion-water dimer geometries for all ion species considered in this study,
namely \ce{F^-}, \ce{Cl^-}, \ce{Br^-}, \ce{I^-}, \ce{Li^+}, \ce{Na^+}, \ce{K^+}, \ce{Rb^+}, \ce{Cs^+}, \ce{Mg^{2+}}, and \ce{Ca^{2+}}.
For all ions, we also ran a 10ps \textit{ab initio} molecular dynamics simulation
at 500K with $\omega$B97X-V/def2-TZVPPD to generate more probable ion-water configurations. We then sampled 2400 evenly spaced
configurations from this trajectory to be used for parameterization.

Some larger ion-water clusters were also generated by the following procedure.
We used the Crest software package\cite{pracht2020automated} which uses the semi-empirical GFN2-XTB\cite{bannwarth2019gfn2}
method to search for global minima on a potential energy surface. We carried out the Crest global minimum
search with five different seed structures generated by taking water clusters, \ce{(H_2O)_n}, n=6-17, from a
water cluster database\cite{rakshit2019atlas} and replacing one water randomly with one of the ions mentioned.
We then took the structures of up to the ten lowest energy minima which had different hydrogen-bond
networks and optimized them at the $\omega$B97X-V/def2-TZVPPD level of theory. This resulted in a total
of 1044 unique ion-water clusters. These full clusters
are used to characterize the ion-water potentials, but we also extracted all possible dimers
and trimers from these clusters to be used in fitting of the ion force field parameters.

All energies and forces that are used in fitting parameters of the force field are computed
at the $\omega$B97X-V/def2-QZVPPD level of theory. In the cases where clusters are optimized at
$\omega$B97X-V/def2-TZVPPD, we recompute the energies of those clusters and any derived sub-structures
with $\omega$B97X-V/def2-QZVPPD.

\section*{Parameterization}

When parameterizing this force field, we fit each term against only the EDA contribution
to that particular energy. We also try to ensure that the force field reproduces
all phsyically meaningful monomer properties including the dipole moment, dipole derivatives,
molecular polarizability, and polarizability derivatives. Optimization of parameters is done using simple gradient descent
against the root mean-square deviation (RMSD) of predicted and EDA energies.
For Pauli repulsion and electrostatics 200 random water dimers from the datasets
described above are used in fitting. For dispersion, polarization, and charge transfer, we use
200 random water dimers, trimers, tetramers, and pentamers from the datasets described above.

When parameterizing electrostatics, we optimize against two objectives. First, we ensure
that the dipole derivatives at the equilibrium geometry of water are correct (this can be achieved
nearly exactly). Second, we optimize against the distributed multipole electrostatic energy described
near Eq. \ref{eq:cp}. Additionally, we also include 200 random dimers
of \ce{Cl^-(H2O)} and \ce{K^+(H2O)} when fitting against the distributed multipole electrostatics.
This seems to help with optimizing to physically meaningful multipoles.
At this point, we freeze the total charges and dipoles on each atom so that the dipole derivatives
will remain correct. Next, we fit the value of the core charges, $Z$ and electrostatic exponents, $b_{elec}$, on each atom
with respect to the total electrostatic energy from EDA. We also allow the quadrupoles to relax
against the total electrostatic energy as a form of compensation for the lack of higher-order multipoles.

Like electrostatics, polarization parameters need to be constrained to give physically meaningful
parameters. Specifically, in addition to EDA energies, we include the polarizability and polarizability derivatives
at the $\omega$B97X-V/def2-QZVPPD equilibrium geometry of water in the fitting process.
The loss function we minimize against is,
\begin{equation}
  L_{pol}=\sqrt{\frac{\sum_{i=1}^{N}(E_i^{FF}-E_i^{EDA})^2}{N}} + w_1||\bm{\alpha}^{FF}-\bm{\alpha}^{EDA}||+w_2||\frac{\partial\bm{\alpha}^{FF}}{\partial \bm{r}}-\frac{\partial\bm{\alpha}^{EDA}}{\partial \bm{r}}||
\label{eq:pol_loss}
\end{equation}
\noindent
In the above, the first term is the RMSD of the predicted energies, $E_i^{FF}$, from the
EDA energies $E_i^{FF}$. The second term is the frobenius norm of the difference between the
computed and predicted molecular polarizabilities, $\bm{\alpha}$. The third term is the same as
the second but for the polarizability derivatives. The weights, $w_1$ and $w_2$ are set to
1.0 and 0.01 respectively. This, in essence, forces the molecular polarizability to be
reproduced exactly while allowing for error in the polarizability derivatives which are much
more difficult to reproduce.

The dipole derivatives needed to evaluate the field-dependent morse potential, Eqs. \ref{eq:bond_in_field} and \ref{eq:ke_in_field}
are computed from electronic structure. Specifically, we take a water dimer at its equilibrium
distance and do a scan of the hydrogen-bonded \ce{O-H} distance, keeping all other coordinates fixed,
and compute the dipole moment at each configuration. This total dipole moment is then projected along
the \ce{O-H} vector. The value of this projected dipole moment is fit to a second-order polynomial
whose coefficients are the first and second dipole derivatives (see Figure S1).

The charge transfer energy and dispersion energies are simply fit against the RMSD
from their EDA energies. Note that for electrostatics and Pauli repulsion, we only use dimers in
the fitting process since electrostatics is strictly pairwise-additive and Pauli repulsion is nearly so.
Dispersion, on the other hand, has a large enough many-body contribution that if only dimers
are used in the fitting, one will systematically over-estimate the dispersion energy since
many-body dispersion is usually repulsive. There are methods for modeling many-body dispersion,
but we have not included such terms in this model.\cite{anatole2010two,van2018new}

The Pauli repulsion term is first fit against the RMSD of the corresponding EDA energy.
The repulsion parameters are then allowed to relax against the total interaction energy
for only dimers. This procedure essentially results in improved error cancellation
which we find is still necessary for a robust force field despite the effort
to create a physically meaningful force field. We will have more to say about the necessity
of error cancellation in force fields later. It should be noted that we only allow
the Pauli repulsion to optimize against dimers so that it cannot correct errors
in the many-body contributions. Furthermore, we will see that the Pauli repulsion energy
still ends up providing an unbiased estimate of the EDA Pauli repulsion energy.

\section*{Results and discussion}
\subsection*{Motivation for Modelling Many-Body Charge Transfer}

Before describing the outcomes of applying our model to various water clusters and
ion-water clusters, let us discuss two important problems which we set out to solve
in the construction of this model. First, it is broadly understood that there are
contributions to the non-additive component of molecular interactions other than
classical mutual polarization. By classical mutual polarization, we mean what some
authors call induction.\cite{herman2023accurate} Induction aims to describe
how multipoles are induced under an applied field, field gradient, etc.
and how these induced multipoles interact further. The reason this is classical
is that it does not describe the effect of charge delocalization which we refer to
as charge transfer. Note that charge transfer can be understood as energetic
stabilization associated with tunneling of electrons between molecules
and hence grows exponentially at short distances.\cite{misquitta2013charge}

We will focus on the EDA definition of charge transfer energy in this work, though
other definitions are possible based on symmetry-adapted perturbation theory.\cite{stone2009charge,misquitta2013charge}
If we consider that charge transfer involves the transfer of actual charge between
molecules, which is certainly the case in EDA\cite{thirman2018characterizing},
then it should be clear that there are both attractive and repulsive contributions
to charge transfer. The attractive part is the energy lowering associated with delocalizing
the electron density. The repulsive part arises from any molecule having a non-integer
total charge. It can be seen that there must be a penalty for having non-integer
charges since the energy of a system with a fractional number of electrons is exactly
a linear interpolation of the energy of the two nearest states with integer charges.\cite{perdew1982density}
Therefore, if there were no penalty for moving a fraction of an electron from one molecule to another,
then the system would not be in the ground state electronic arrangement, which we
assume to be true in this model.

\begin{figure}[H]
  \includegraphics*[width=\textwidth]{figures/trimer_mbe_example.png}
  \caption{Two water trimers illustrating the importance of both polarization
  and charge transfer for the stability of water molecules. FRZ corresponds to
  the frozen contribution: the sum of Pauli, electrostatic, and dispersion enegies. POL is the polarization
  energy and CT is the charge transfer energy. Energies are computed at the
  $\omega$B97X-V/def2-QZVPPD level of theory. See text for discussion.}
  \label{fig:trimer}
\end{figure}

The existence of a penalty for moving charge between molecules makes it clear
why many-body charge transfer is non-negligible. Figure \ref{fig:trimer} illustrates
how hydrogen bond networks benefit from many-body charge transfer. Let us imagine that
an equal amount of charge is transferred along each hydrogen bond, represented by arrows. 
In the trimer on the left, the hydrogen bonds are organized in such a way that some molecules
donate more hydrogen bonds than they receive and vice versa. This means that some molecules
in the trimer on the left will end up with nonzero total charges. This is consistent
with the known instability of double acceptor water molecules which do not donate
any hydrogen bonds.\cite{kirov2008identifying}

In the trimer on the right, each molecule donates and receives the same number of hydrogen bonds.
This means each molecule will have a nearly net-zero charge while still
benefitting from charge delocalization along each hydrogen bond. Now, if we imagine
removing any water molecule from the trimer on the right, the two remaining molecules would have
have nonzero total charges and hence incur a penalty. The elimination of this penalty
when a third molecule is added to the network is exactly what gives rise to a many-body charge transfer stabilization.

The ability of hydrogen bond networks
to delocalize charge while keeping each fragment very nearly neutral seems to us
an under-appreciated aspect of hydrogen bond cooperativity. Indeed, the trimer on the right
is a so-called homodromic ring, which results in optimal cooperativity
of the induced dipoles on each molecule.\cite{xantheas2000cooperativity} This can be
seen by the large 3-body polarization contribution of $-1.66$ kcal/mol. We highlight, here,
that there is an additional non-negligible 3-body contribution due to charge transfer of
$-0.76$ kcal/mol. The fact that water can receive and donate two hydrogen bonds simultaneously
makes it uniquely capable of passing charge between molecules while keeping the total charge
of each molecule neutral.

It is interesting to note that the frozen term, i.e. the sum of electrostatics, dispersion, and
Pauli repulsion can end up being smaller than either the polarization or charge transfer contributions.
Additionally, although not shown explicitly here, the charge penetration contribution, Eq. \ref{eq:cp}, to the
electrostatic energy of a hydrogen bond is typically about equal to the point-electrostatic contribution.
This begs the question of how so many force fields have been even qualitatively successful while
neglecting such large components of the intermolecular energy?

\begin{figure}[H]
  \includegraphics*[width=\textwidth]{figures/pauli_ct_cp_correlation.png}
  \caption{Correlation between (A) charge penetration energy (CP), (B) charge transfer energy (CT),
  and (C) their sum against Pauli repulsion energy.
  Energies are computed at the $\omega$B97X-V/def2-QZVPPD level of theory. See text for discussion.}
  \label{fig:cp_ct_pauli}
\end{figure}

Figure \ref{fig:cp_ct_pauli} demonstrates that force fields have succeeded despite neglecting
charge transfer (CT) and charge penetration (CP) simply because CT and CP are exceptionally
strongly correlated to Pauli repulsion. This observation is extremely robust for water. Clearly,
most force fields are implicitly describing CT and CP by having too soft of a repulsive wall
when compared against an \textit{ab initio} calculation of Pauli repulsion such as that from EDA.
It is rather easy to see from Figure \ref{fig:cp_ct_pauli} that the sum
of CT and CP is generally better correlated to Pauli repulsion than either term individually. Whether
or not this correlation holds as robustly for other systems is beyond the scope of this work. Figure
\ref{fig:cp_ct_pauli} does raise the alarming possibility that adding charge penetration to a force field
without adding charge transfer can make the force field worse by destroying a fortuitous cancellation
of errors. We consider that Figures \ref{fig:trimer} and \ref{fig:cp_ct_pauli} provide ample motivation for the
development of a better model for charge transfer, which we present here.

\subsection*{Water Monomer Properties}

In the construction of this model, we have gone to great lengths to ensure that the model
reproduces as many properties of the water monomer as possible. For instance,
in Figure \ref{fig:dipole_surface} we make a comparison between the dipole
surface of this model and the reference surface computed with $\omega$B97X-V/def2-QZVPPD.
We also show two references of possible interest. The blue points correspond to the
dipole surface of a force field with fixed charges and dipoles that optimally
reproduce the electrostatic dimer EDA data described earlier. Clearly, fixed charge
force fields completely fail to reproduce the dipole surface of water.

\begin{figure}[H]
  \includegraphics*[width=\textwidth]{figures/dipole_surface.png}
  \caption{The dipole surface of water for all structures taken from a
  3-D scan of water internal coordinates with a deformation energy less than
  20 kcal/mol. The black dashed line shows the values computed with $\omega$B97X-V/def2-QZVPPD.
  The green dashed line corresponds to the experimental gas-phase dipole moment
  of water of 1.85 Debye.
}
  \label{fig:dipole_surface}
\end{figure}

The orange points in Figure \ref{fig:dipole_surface} are the dipole surface associated with
the Partridge-Schwenke (PS) water monomer surface.\cite{partridge1997determination}
The PS potential and dipole surface are used by many water models such as the TTM models,\cite{burnham1999parametrization,fanourgakis2006flexible}
MB-Pol\cite{babin2013development,babin2014development}, and q-aqua\cite{yu2022q}.
Clearly, the PS dipole surface is very accurate over a wide range of energies. We chose
not to use the PS dipole surface since we intend to construct
force fields for molecules other than water. Clearly, we have not sacrificed much
since the FQCT dipole surface essentially parallels the PS dipole surface.

It was first pointed out by Fanourgakis and Xantheas that reproducing the dipole surface of water
is essential for capturing the opening of the bend angle of water in the condensed phase.\cite{fanourgakis2006flexible}
Essentially, a model needs to reproduce the dipole derivatives of water to correctly predict
the opening of the bend angle as water clusters become larger. Our model is able to reproduce
the dipole derivatives of water to five decimal places in atomic units.

Another important property for accurate energetics and transferability, especially for interactions with ions,
is the molecular polarizability. Because our model contains anisotropic dipole polarizabilities
and fluctuating charges, there is more than enough flexibility in parameter space to exactly reproduce
the molecular polarizability. Our model aims to reproduce the $\omega$B97X-V/def2-QZVPPD molecular
polarizability with $\alpha_{xx}=10.0321$, $\alpha_{yy}=9.65958$, $\alpha_{zz}=9.40921$, which it manages
to do up to five decimal places in bohr$^3$. The quoted polarizability values correspond to a water
molecule with the x-axis as the bisector of the HOH angle and the z-axis normal to the plane of the
water molecule.

The last monomer property we explicitly aimed to reproduce are the polarizability
derivatives of gas-phase water at its equilibrium geometry. The polarizability derivatives control
the intensity of peaks measured with raman spectroscopy but have rarely been
discussed in the construction of water models to our knowledge. Additionally, since water distorts when interacting
with other molecules, reproducing the polarizability derivatives indicates how well the molecular polarizability
at distorted geometries will be reproduced. In Table \ref{tab:pol_derivs}, we report the polarizability derivatives of our final model
as well as the polarizability derivatives for an identically parameterized model which does not include
fluctuating charges. It is important to note that one can achieve better agreement with reference
polarizability derivatives if that is the only quantity one aims to reproduce. These models, however, tend
to result in inadequate polarization energies.

\begin{table}[ht!]
  \begin{center}
  \begin{tabular}{ccccc}
      \multicolumn{5}{c}{Polarizability Derivatives of Water (bohr$^2$)} \\\hline
       Atom & $xx$ & $xy$ & $yy$ & $zz$ \\\hline
       O$x$ & -                 & 4.04/2.92/-0.13    & -                  & -  \\
       O$y$ & 5.15/1.58/2.04    & -                  & 4.45/3.24/-2.03    & 1.50/0.0/0.0  \\
       O$z$ & -                 & -                  & -                  & -  \\
       H$x$ & -4.61/-2.57/0.78  & -2.02/-1.46/0.06   & -2.53/-0.60/-0.78  & -1.39/0.0/0.0  \\
       H$y$ & -2.57/-0.79/-1.02 & -1.68/-1.25/-0.08  & -2.22/-1.62/1.02   & -0.75/0.0/0.0  \\
       H$z$ & -                 & -                  & -                  & -  \\\hline

  \end{tabular}
  \end{center}
  \vspace{-3mm}
  \caption{Polarizability derivatives of water computed at the $\omega$B97X-V/def2-QZVPPD equilibrium geometry
  in three different ways. The first entry is computed with $\omega$B97X-V/def2-QZVPPD, the second with FQCT,
  and the third with the same model but using parameters optimized without fluctuating charges.
  The Atom column tells both the atom and component
  of its position we take the derivative with respect to.
  The water monomer has its bisector aligned with the $x$-axis and the $z$-axis is normal to the water 
  molecule plane. Note that the derivatives for the second hydrogen are identical to the first
  but with opposite sign. The $xz$ and $yz$ entries are omitted since they are small and
  reproduced to three decimal places by both models.}
  \label{tab:pol_derivs}
\end{table}

Certain polarizbility derivatives in Table \ref{tab:pol_derivs} are reproduced very accurately,
while others are not at all. Most notably, our model does not have any $zz$ polarizability derivatives
while these should be rather large. The reason our model has no $zz$ polarizability derivatives
is that we do not include intramolecular polarization. We tested what happens when intramolecular
polarization is turned on and found that the $zz$ polarizability derivatives are still reproduced
very poorly and the polarization energies generally became less accurate. It is of some interest that
when intramolecular polarization is turned on, the polarizability derivatives are quite sensitive
to the choice and strength of damping function. This may enable the tuning of damping functions
based on monomers alone.

We find it very interesting that the model which includes fluctuating charges in the polarization
calculation gives much better polarizability derivatives than one which just uses anisotropic dipole
polarizabilities. This indicates that one of the main reasons water models have historically
predicted Raman intensities very poorly\cite{hamm20142d} is the lack of fluctuating charges in the
polarization process. Furthermore, we are able to achieve higher accuracy in the polarization energies
using fluctuating charges than without.

The $zz$ polarizability derivatives of water are an interesting case
since they can be reproduced accurately when using intramolecular polarization, but in our experience, the strength
of damping to enable this is too weak to have a stable water model. This indicates that an
interesting future direction for advanced force fields is the construcion of geometry-dependent
polarizability surfaces. In much the same way that recent force fields employ
charge flux to ensure accurate dipole surfaces, future models will benefit from
accurate polarizability surfaces. Indeed, some recent work indicates that
simple linear interpolation based on internal coordinates may be sufficient for water.\cite{herman2023accurate}
Linear models of charge flux are accurate for organic molecules\cite{sedghamiz2017probing,yang2020accurate},
but the same remains to be seen for the polarizability surface of organic molecules.

It is difficult to compare the accuracy of the polarizability derivatives of this model
to others since very few models report this quantity. At least one water model has been constructed
for the express purpose of reproducing Raman spectra.\cite{sidler2018efficient}
The polarizability derivatives were not reported. The polarization is described using
anisotropic polarizabilities but no fluctuating charges which, based on the contents of
Table \ref{tab:pol_derivs}, lead us to believe the present model likely has more accurate
polarizability derivatives.

\subsection*{Water Model}

Having characterized the properties of the monomer surface used in this model, let
us turn our attention to its performance on intermolecular properties. To that end, Table \ref{tab:mae}
presents the mean absolute errors (MAEs) over each cluster size for each
energy category in the EDA. Focusing on the dimers first, it is clear that the term
in error by the most is Pauli repulsion, but even this is in error by less than 0.25 kcal/mol
on average. Note that this MAE includes the re-parameterization to maximize error cancellation.
Without including error cancellation, the Pauli MAE for dimers is 0.20 kcal/mol and all other terms,
besides the interaction energy, remain the same. In general, the MAEs obtained by this model are
excellent.

In addition to the MAEs for each category of the EDA, we also report the skewness of the error distribution.
The skewness is the standardized third moment of a distribution and is a simple measure of asymmetry.
Ideally, this number will be zero indicating that the errors are symmetrically distributed. For reference,
a skewness between -0.5 and 0.5 is generally interpreted as indicating an approximately symmetric distribution.
Therefore, every individual term in our model is very nearly unbiased in the sense of having approximately
symmetric errors. The only term of some concern is the interaction energy of dimers which
has a skewness of 0.982. Note, however, that the MAE is 0.088 kcal/mol and this asymmtry in the error shrinks
as large clusters are considered.
One contributor to the asymmetry in the dimer interaction energies is the lack of many-body dispersion.
That is, we have not included many-body dispersion in this model and, as a result, we have to fit the dispersion to implicitly account for this error.
This is why the distribution of dispersion errors starts out positively skewed (i.e. too weakly attractive) and
ends up negatively skewed (i.e. too attractive). This follows from the fact that many-body dispersion is repulsive
on average. It is quite interesting to note that the interaction energy
is in error by less than every category besides polarization and dispersion. This immediately indicates that
there must be rather significant error cancellation.

\begin{table}[ht!]
  \begin{center}
  \begin{tabular}{lccccc}
      \multicolumn{5}{c}{MAE of Force Field EDA Terms (kcal/mol)} \\\hline
       & \ce{(H2O)2} & \ce{(H2O)3} & \ce{(H2O)4} & \ce{(H2O)5} \\\hline
      %Deform. &  &  &  &  \\
      Pauli (no error fit)   & 0.201 (0.342) & 0.323 (0.167) & 0.422 (0.090) & 0.523 (-0.029) \\
      Pauli                  & 0.257 (-0.104) & 0.408 (-0.046) & 0.501 (0.097) & 0.650 (-0.201) \\
      Electrostatics         & 0.138 (0.149) & 0.224 (0.169) & 0.288 (-0.066) & 0.364 (0.139) \\
      Dispersion             & 0.067 (0.083) & 0.090 (-0.169) & 0.107 (-0.456) & 0.145 (-0.456) \\
      Polarization           & 0.051 (0.209) & 0.099 (-0.179) & 0.140 (0.292) & 0.182 (0.276) \\
      Charge Transfer        & 0.116 (0.134) & 0.175 (0.054) & 0.235 (-0.161) & 0.295 (0.048) \\\hline
      Interaction            & 0.088 (0.982) & 0.179 (0.429) & 0.255 (0.063) & 0.328 (0.265) \\\hline
  \end{tabular}
  \end{center}
  \vspace{-3mm}
  \caption{Comparison of the mean absolute error (MAE) in kcal/mol of all terms in the EDA against predictions of our
  water model for hydrogen-bonded water dimers, trimers, tetramers, and pentamers. The numbers in parentheses are
  the skewness of the error distribution.
  In total, there are 2400 each of dimers, trimers, tetramers, and pentamers.
  The first row shows the Pauli repulsion energy without inclusion of error fitting
  while the second row is the Pauli repulsion used in the final model which is calibrated
  to maximize error cancellation.}
  \label{tab:mae}
\end{table}

\begin{figure}[h]
  \includegraphics*[width=\textwidth]{figures/error_correlation.png}
  \caption{Correlation of the attractive errors (i.e. all terms besides Pauli) and
  error in Pauli repulsion. Figure A shows the error correlation without any error
  fitting. That is, each EDA term is fit completely independently. Figure B shows
  the same plot after allowing the Pauli repulsion to relax against the interaction
  energy for dimers only. See section on parameterization for more details.
}
  \label{fig:error_correlation}
\end{figure}

Figure \ref{fig:error_correlation} shows the correlation of errors in all attractive terms (i.e. not Pauli)
and Pauli repulsion both with and without error fitting. As a reminder, we only allow the Pauli
repulsion parameters to adjust against the interaction energies and we only use water dimers
when fitting for error cancellation. This makes it clear that even for larger clusters, the
predominant source of error is in the dimers. Virtually all force fields take advantage
of some kind of error cancellation during parameterization. While it would be preferable
if no error cancellation was required to construct quantitative force fields, we find it
highly unlikely that this will ever be the case. This is because making quantitative
force fields requires an accurate description of short-range interactions which requires
modelling quantum mechanics based on simple functional forms. As will be seen, we think this
force field is a major step forward in modelling charge transfer, which is a purely
quantum mechanical phenomenon, but even so, tuning the error cancellation was necessary to
quantitatively reproduce cluster energetics and structures.

One might wonder why this model is so effective at taking advantage of error cancellation.
We believe this stems from two facts. First, as discussed, all of the terms in
this force field are very nearly unbiased. That is, each term is nearly equally likely
to be in error by a positive or negative energy. This means the total energy is also unbiased
and small tweaks to the Pauli parameters will tend to rapidly correlate the errors in each term.
Second, error cancellation is to be expected from the simple fact that Pauli repulsion and all other terms are naturally
correlated. This is easily seen in Figure \ref{fig:cp_ct_pauli} where the sum of charge penetration
and charge transfer are linearly correlated to Pauli repulsion over a very wide energy range.
Also, Figure \ref{fig:error_correlation}A shows that just by fitting each EDA term, our model naturally
correlates attractive and repulsive errors. To put it simply, when repulsion gets stronger,
all of the attractive terms also get stronger, so some amount of error cancellation is basically guaranteed.

\begin{table}[ht!]
  \begin{center}
  \begin{tabular}{llccccccc}
      \multicolumn{9}{c}{Comparison of Methods on Benchmark Water Cluster Binding Energies} \\\hline
      \ce{(H2O)_n}& Isomer & q-AQUA & MB-Pol & FQCT & $\omega$B97X-V & HIPPO & TTM2.1-F & Ref. \\\hline
      \ce{(H2O)_2} &  & -4.97 & -4.96 & -4.95 & -5.00 & -4.96 & -5.03 & -4.99 \\
      \ce{(H2O)_3} &  & -15.73 & 15.69 & -15.51 & -15.77 & -15.77 & -15.94 & -15.77 \\
      \ce{(H2O)_4} &  & -27.35 & -27.18 & -27.48 & -27.75 &	-26.69 & -27.62 &	-27.39 \\
      \ce{(H2O)_5} &  & -35.71 & -35.55 & -36.65 & -36.51 &	-34.58 & -36.81 &	-35.9 \\
      \ce{(H2O)_6} & Prism & -46.21 & -45.94 & -46.24 & -46.53 &	-46.15 & -45.91 &	-46.2 \\
      \ce{(H2O)_6} & Cage & -45.94 & -45.66 & -45.98 & -46.30 &	-45.39 & -46.51 &	-45.9 \\
      \ce{(H2O)_6} & Book & -45.21 & -44.89 & -45.93 & -45.95 &	-44.25 & -46.09 &	-45.4 \\
      \ce{(H2O)_6} & Ring & -43.71 & -43.66 & -45.82 & -45.07 &	-42.54 & -45.17 &	-44.3 \\
      \ce{(H2O)_7} &  & -57.71 & -57.11 & -57.99 & -58.08 & - &	-57.83 & -57.4 \\
      \ce{(H2O)_8} & $D_2d$ & -73.32 & -72.38 & -73.24 & -73.58 & -71.55 & -73.3 & -73.0 \\
      \ce{(H2O)_8} & $S_4$ & -72.93 & -72.06 & -73.30 & -73.55 & -71.56 & -73.33 & -72.9 \\
      \ce{(H2O)_9} & $D_2dDD$ & -82.87 & -81.4 & -82.96 & -83.00 & - & -83.4 & -83.0 \\
      \ce{(H2O)_{10}} &  & -94.72 &	-92.53 & -94.64 &	-94.50 & - & -94.66 &	-94.6 \\
      \ce{(H2O)_{11}} & 43'4 & -104.23 & -103.93 & -102.69 & -103.77 & -100.23 & -104.14 & -104.6 \\
      \ce{(H2O)_{16}} & Antiboat & -164.87 & -160.89 & -165.21 & -164.20 & -159.63 & -165.99 & -164.6 \\
      \ce{(H2O)_{16}} & 4444-a & -163.10 & -162.28 & -164.70 & -164.28 & -161.84 & -167.25 & -164.2 \\
      \ce{(H2O)_{16}} & 4444-b & -162.54 & -161.08 & -164.43 & -163.84 & -161.56 & -167.11 & -164.1 \\
      \ce{(H2O)_{16}} & Boat a & -164.53 & -161.43 & -164.68 & -164.51 & -159.36 & -165.71 & -164.4 \\
      \ce{(H2O)_{16}} & Boat b & -164.31 & -160.86 & -164.80 & -164.35 & -159.43 & -165.82 & -164.2 \\
      \ce{(H2O)_{17}} & Sphere & -177.56 & -171.75 & -177.20 & -175.78 & -170.68 & -178.60 & -175.7 \\
      \ce{(H2O)_{20}} & ES Prism & -212.49 & -207.84 & -213.82 & -211.98 & - & -216.46 & -214.2 \\
      \ce{(H2O)_{20}} & FS Prism & -210.63 & -206.96 & -211.08 & -210.12 & - & -214.07 & -211.9 \\
      \ce{(H2O)_{20}} & Fused Cubes & -208.07 & -207.45 & -210.61 & -209.90 & - & -214.34 & -210.6 \\
      \ce{(H2O)_{20}} & Pentag. Dodec. & -199.79 & -195.22 & -201.69 & -201.22 & - & -202.22 & -200.8 \\
      \ce{(H2O)_{25}} & Isomer 2 & -276.50 & -266.04 & -273.33 & - & - & -277.06 & -276.3 \\\hline
      MAE/n & & \textbf{0.040} &	\textbf{0.156} &	\textbf{0.053} &	\textbf{0.051} & \textbf{0.194} & \textbf{0.092} & - \\\hline
  \end{tabular}
  \end{center}
  \vspace{-3mm}
  \caption{Comparison of various advanced force fields and $\omega$B97X-V/def2-QZVPPD against benchmark cluster energies.\cite{herman2023extensive}
  The reference energies are mostly CCSD(T)/CBS values but some are MP2/CBS values. See original paper for further
  details on structures.\cite{herman2023extensive}
  Any energies which could not be found in the literature are left blank.
  The bottom row shows the mean absolute error per molecule for all available energies.
  }
  \label{tab:benchmark_energies}
\end{table}

\begin{table}[ht!]
  \begin{center}
  \begin{tabular}{llccccc}
      \multicolumn{7}{c}{Comparison of Methods on Benchmark Water Cluster Structures} \\\hline
      \ce{(H2O)_n}& Isomer & q-AQUA & MB-Pol & FQCT & $\omega$B97X-V & TTM2.1-F \\\hline
      \ce{(H2O)_2} &  & 0.005 &	0.008 &	0.013 &	0.005 &	0.059 \\
      \ce{(H2O)_3} &  & 0.01 &	0.014 &	0.022 &	0.008 &	0.077 \\
      \ce{(H2O)_4} &  & 0.008 &	0.024 &	0.019 &	0.006 &	0.102 \\
      \ce{(H2O)_5} &  & 0.013 &	0.059 &	0.043 &	0.008 &	0.156 \\
      \ce{(H2O)_6} & Prism & 0.01	& 0.035	& 0.014	& 0.009	& 0.094 \\
      \ce{(H2O)_6} & Cage & 0.013	& 0.027	& 0.027	& 0.018	& 0.134 \\
      \ce{(H2O)_6} & Book & 0.01	& 0.029	& 0.048	& 0.009	& 0.142 \\
      \ce{(H2O)_6} & Ring & 0.013	& 0.043	& 0.032	& 0.010	& 0.158 \\
      \ce{(H2O)_7} &  & 0.016 &	0.041 &	0.031 &	0.025 &	0.122	\\
      \ce{(H2O)_8} & $D_2d$ & 0.006	& 0.041 &	0.016	& 0.004	& 0.068 \\
      \ce{(H2O)_8} & $S_4$ & 0.007	& 0.019 &	0.016	& 0.005	& 0.064 \\
      \ce{(H2O)_9} & $D_2dDD$ & 0.089 &	0.116 &	0.038 &	0.052 &	0.207 \\
      \ce{(H2O)_{10}} &  & 0.012 & 0.049 & 0.022 & 0.010 & 0.085 \\
      \ce{(H2O)_{11}} & 43'4 & 0.034 & 0.065 & 0.031 & 0.017 & 0.102 \\
      \ce{(H2O)_{16}} & Antiboat & 0.023 & 0.064 & 0.037 & 0.017 & 0.094 \\
      \ce{(H2O)_{16}} & 4444-a & 0.039 & 0.038 & 0.026 & 0.015 & 0.074 \\
      \ce{(H2O)_{16}} & 4444-b & 0.04 & 0.049 & 0.025 & 0.029 & 0.071 \\
      \ce{(H2O)_{16}} & Boat a & 0.023 & 0.038 & 0.027 & 0.016 & 0.076 \\
      \ce{(H2O)_{16}} & Boat b & 0.028 & 0.057 & 0.056 & 0.016 & 0.102 \\
      \ce{(H2O)_{17}} & Sphere & 0.039 & 0.063 & 0.034 & 0.022 & 0.086 \\
      \ce{(H2O)_{20}} & ES Prism & 0.042 & 0.056 & 0.048 & 0.024 & 0.076 \\
      \ce{(H2O)_{20}} & FS Prism & 0.047 & 0.05 & 0.025 & 0.023 & 0.090 \\
      \ce{(H2O)_{20}} & Fused Cubes & 0.067 & 0.05 & 0.027 & 0.029 & 0.073 \\
      \ce{(H2O)_{20}} & Pentag. Dodec. & 0.034 & 0.066 & 0.042 & 0.018 & 0.149 \\
      \ce{(H2O)_{25}} & Isomer 2 & 0.029 & 0.049 & 0.048 & 0.023 & 0.109 \\\hline
      RMSD (\AA) & & \textbf{0.026} &	\textbf{0.046} &	\textbf{0.031} &	\textbf{0.017} & \textbf{0.132} \\\hline
  \end{tabular}
  \end{center}
  \vspace{-3mm}
  \caption{Comparison of various advanced force fields and $\omega$B97X-V/def2-QZVPPD against benchmark cluster structures.\cite{herman2023extensive}
  The reference structures are optimized at either CCSD(T)/aug-cc-pVDZ or MP2/aug-cc-pVTZ. See original paper for further
  details on structures.\cite{herman2023extensive}
  The bottom row shows the root mean-squared deviation (RMSD) in angstrom for all available structures.
  }
  \label{tab:benchmark_structures}
\end{table}

One of the major goals of this model is to quantitiatively reproduce the many-body contributions
to both polarization and charge transfer. To assess how well we have achieved this, we computed
the three-body contribution to both polarization and charge transfer for many trimers extracted
from the ion-water clusters used in parameterizing the ions. That is, these water trimers were
not used in parameterizing the water model. The three-body polarization and
charge transfer energy are defined as, $E_{3B}(123)=E(123)-E(12)-E(13)-E(23)$. That is,
we take any EDA energy component for a trimer, $E_{3B}(123)$, and subtract off the same
EDA energy component for the three dimers forming that trimer. There is no one-body
contribution to this energy since EDA only deals with intermolecular forces.

\begin{figure}[h]
  \includegraphics*[width=\textwidth]{figures/three_body_pol_and_ct_water.png}
  \caption{Correlation plot of the three-body contribution to polarization and
  charge transfer as computed by our model and with $\omega$B97X-V/def2-QZVPPD.
  All water trimers in this plot are drawn from ion-water clusters and therefore
  span a wide range of configurations, some of which are atypical of liquid water.
  Since trimers drawn from a cluster may be disonnected, we enforce that the trimer
  have an absolute three-body contribution of at least 0.02 kcal/mol.
}
  \label{fig:pol_ct_water}
\end{figure}

Figure \ref{fig:pol_ct_water} shows what we consider to be excellent agreement with
electronic structure for the major three-body contributions to the energy. Indeed, the
model manages to capture both repulsive and attractive three-body contributions to both
polarization and charge transfer despite repulsive three-body contributions to either
of those quantities being absent in ordinary water clusters.\cite{heindel2020many} In fact, 
ion-water clusters have been shown to have repulsive three-body contributions in many cases.\cite{heindel2021many,herman2021many}
We consider Figure \ref{fig:pol_ct_water} a strong validation that our models of polarization
and charge transfer capture the salient physics that generates these many-body energies.

We have also computed the energy at the force-field optimized geometries of several clusters
for which high-quality benchmark energies are available.\cite{herman2023extensive}
Table \ref{tab:benchmark_energies} shows the energies predicted by our model and several other force fields
for which data is available. It is worth noting that both q-AQUA and MB-Pol include
fits of the 2-body, 3-body, and in the case of q-AQUA, 4-body contributions to the energy.
Therefore, the fact that we are able to achieve an MAE over all clusters intermediate
between these models is a great result. Interestingly, MB-Pol seems to have a tendency to
underestimate the binding energy of clusters as they get larger. Presumably this shortcoming
has been corrected in the updated version of MB-Pol\cite{zhu2023mb} which is reportedly at
least as accurate as q-AQUA.

As highlighted in the methods section, the electrostatics and pauli repulsion used in this
model are the same as those used in HIPPO.\cite{rackers2021polarizable} It is very encouraging,
therefore, to see that our model improves on the MAEs of the HIPPO model rather substantially.
One of the main reasons we are able to achieve better MAEs is that our many-body energies, as shown
in Figure \ref{fig:pol_ct_water}, are both accurate and nearly unbiased. The HIPPO model systematically
underestimates the many-body contributions to water cluster energies\cite{rackers2021polarizable},
which is likely attributable to the absence of many-body charge transfer.

Finally, note that we have included $\omega$B97X-V/def2-QZVPPD in Table \ref{tab:benchmark_energies} since
this is the reference method for our force field. It is clear that this level of theory
compares very favorably to the CCSD(T)/CBS and MP2/CBS numbers used as reference. The MAE for
$\omega$B97X-V is also a useful benchmark since the best our force field can possibly perform
is to reproduce these numbers.

In addition to accurate energetics, polarizable force fields should produce accurate geometries
compared to electronic structure. To this end, Table \ref{tab:benchmark_structures} shows the root mean-squared
deviation (RMSD) of water cluster structures optimized with various force fields and $\omega$B97X-V/def2-QZVPPD
compared to previously reported structures optimized with either CCSD(T) or MP2.\cite{herman2023extensive}
The average RMSD for our model manages to outperform MB-Pol and is comparable even to
q-AQUA. Notably, $\omega$B97X-V/def2-QZVPPD is even more accurate on this benchmark than q-AQUA
which provides further evidence of the high accuracy of this functional.

Unfortunately, TTM2.1-F struggles at accurately reproducing the structures of water clusters. It is important
to realize, however, that TTM2.1-F was published in 2006\cite{fanourgakis2006flexible} and
is itself a minor modification of TTM2-F which was published in 2002.\cite{burnham2002development}
TTM2.1-F is quite simple compared to the present model and MB-Pol or q-AQUA, so it is not
surprising that it falls short on certain benchmarks. We bring this up not to criticize TTM2.1-F, which
was highly innovative and an inspiration in this work, but to emphasize that it is possible to have accurate
energies but sub-optimal structures in the same model. Therefore, we suggest that any future water models should
benchmark both energies and structures.

We have already shown in Figure \ref{fig:pol_ct_water} that our model produces accurate three-body contributions to polarization
and charge transfer for water trimers extracted from ion-water clusters. It is interesting to see, however,
the 2-body and many-body contributions to each component of the energy for whole water clusters. To that end,
we computed the 2-body and many-body contributions for a subset of the reference structures
used in Tables \ref{tab:benchmark_energies} and \ref{tab:benchmark_structures}. A comparison
of these quantities as computed from EDA with $\omega$B97X-V/def2-QZVPPD is shown in Table \ref{tab:mbe}.

\begin{landscape}
\begin{table}[ht!]
  \begin{center}
    \begin{tabular}{llcccccccccc}
      \multicolumn{12}{c}{Comparison of Many-Body Expansion for EDA Components (kcal/mol)} \\\hline
      \ce{(H2O)_n}& Component & \multicolumn{2}{c}{Cls. Elec.} & \multicolumn{2}{c}{Mod. Pauli} & \multicolumn{2}{c}{Disp.} & \multicolumn{2}{c}{Pol.} & \multicolumn{2}{c}{CT} \\\hline
      & & FQCT & $\omega$B97X-V & FQCT & $\omega$B97X-V & FQCT & $\omega$B97X-V & FQCT & $\omega$B97X-V & FQCT & $\omega$B97X-V \\\hline
      \ce{(H2O)_3} & 2-Body    & -27.28 & -26.77 & 29.05 & 28.87 &  -6.31  & -6.28  &	-3.38  & -3.48  &	-6.13  & -6.08 \\
             & $\ge$ 3-Body    & -      & -      & 0.0   & -0.24 &   0.0   & 0.21   &	-1.43  & -1.63  &	-0.69  & -0.74 \\\hline
                    & Total    & -27.28 & -26.77 & 29.05 & 28.63 &  -6.31  & -6.07  &	-4.82  & -5.11  &	-6.82  & -6.82 \\\hline
      \ce{(H2O)_6} & 2-Body    & -79.27 & -78.43 & 87.70 & 88.40 &	-19.65 & -19.90 &	-10.53 & -10.94 &	-17.86 & -18.41 \\
      Prism & $\ge$ 3-Body     & -      & -      & 0.0   & -0.62 &	 0.0   & 0.83   &	-6.09  & -6.40  &	-2.71  & -2.80 \\\hline
                    & Total    & -79.27 & -78.43 & 87.70 & 87.78 &	-19.65 & -19.07 &	-16.62 & -17.34 &	-20.57 & -21.21 \\\hline
      \ce{(H2O)_6} & 2-Body    & -79.03 & -78.67 & 89.12 & 90.10 &	-19.13 & -19.36 &	-11.01 & -11.25 &	-19.07 & -19.62 \\
      Cage & $\ge$ 3-Body      & -      & -      & 0.0   & -0.66 &	 0.0   & 0.79   &	-5.99  & -6.26  &	-2.91  & -3.07 \\\hline
                    & Total    & -79.03 & -78.67 & 89.12 & 89.44 &	-19.13 & -18.56 &	-17.00 & -17.51 &	-21.98 & -22.69 \\\hline
      \ce{(H2O)_{10}} & 2-Body & -163.4 & -162.4 & 189.1 & 192.2 &	-37.89 & -38.34 &	-24.16 & -24.92 &	-42.01 & -43.27 \\
                & $\ge$ 3-Body & -      & -      & 0.0   & -0.68 &	0.0    & 1.18   &	-14.24 & -14.92 &	-7.19  & -7.42 \\\hline
                & Total        & -163.4 & -162.4 & 189.1 & 191.5 &	-37.89 & -37.16 &	-38.40 & -39.84 &	-49.20 & -50.69 \\\hline
      \ce{(H2O)_{16}} & 2-Body & -280.5 & -277.7 & 325.0 & 329.0 &	-67.23 & -67.61 &	-41.26 & -42.44 &	-71.59 & -73.15 \\
      Antiboat  & $\ge$ 3-Body & -      & -      & 0.0   & -1.06 &	0.0    & 2.17   &	-25.58 & -27.07 &	-12.05 & -12.37 \\\hline
                & Total        & -280.5 & -277.7 & 325.0 & 327.9 &	-67.23 & -65.44 &	-66.84 & -69.51 &	-83.64 & -85.52 \\\hline
      \ce{(H2O)_{20}} & 2-Body & -358.8 & -355.4 & 416.5 & 420.9 &	-89.17 & -89.20 &	-52.53 & -54.26 &	-91.46 & -92.80 \\
      ES Prism  & $\ge$ 3-Body & -      & -      & 0.0   & -1.66 &	0.0    & 3.03   &	-32.69 & -34.85 &	-15.04 & -15.21 \\\hline
                & Total        & -358.8 & -355.4 & 416.5 & 419.3 &	-89.17 & -86.17 &	-85.22 & -89.11 &	-106.5 & -108.0 \\\hline
    \end{tabular}
  \end{center}
  \vspace{-3mm}
  \caption{Comparison of the 2-body, many-body (i.e. $\ge$ 3-Body), and total energies as predicted by FQCT and as computed with $\omega$B97X-V/def2-QZVPPD.
  Both calculations are done at the \textit{ab initio} optimized geometries. Names of isomers, when applicable, are written below the
  cluster size.
  }
  \label{tab:mbe}
\end{table}
\end{landscape}

One of the significant advantages of using data from EDA to parameterize a
force field is it allows for very fine-grained analysis of the accuracy of a model.
We illustrate this in Table \ref{tab:mbe} by comparing the 2-body, many-body, and total
energies as computed by our force field and $\omega$B97X-V/def2-QZVPPD. First, we can see
that the model is generally very accurate at reproducing each term, as should be expected
given the excellent performance of the model in reproducing total energies and optimized
strcutures. With that being said, there are a couple of apparent shortcomings. First,
we currently do not include many-body dispersion which is very small but not entirely
negligible, especially considering it is the only term besides Pauli repulsion which is
repulsive. It is sometimes argued that many-body dispersion can be ignored since there is
also a small many-body exchange effect which is attractive and hence offsets many-body
dispersion. It is clear from Table \ref{tab:mbe} that this is at least
approximately true in EDA. Even if the cancellation were perfect, however, that does
not guarantee the forces will cancel. For that reason, we may explore adding many-body
dispersion in the future, but neglect it for now since many-body charge transfer
is generally much more important.

Additionally, it is apparent that our model slightly understimates two-body contributions
to both polarization and charge transfer. This likely arises from a limitation of the
functional forms and hence suggests improvements that can be explored in the future.
Our description of many-body contributions to charge transfer, however, are excellent.
Table \ref{tab:mbe} also provides information about ways in which we have gotten lucky
in the parameterization of this model. For instance, in larger clusters the model's dispersion
energies are slightly too attractive while our polarization model is not quite attractive
enough. This cancellation of errors was not intended but likely contributes, in some small
way, to the successes we have seen in Tables \ref{tab:benchmark_energies} and \ref{tab:benchmark_structures}.

We are digging into such detail with the hopes that future force fields will do the same.
Electronic structure only used to be able to provide coarse-grained information in the form
of total energies and forces. This hampered the ability to pinpoint limitations of a force field.
Now, however, we can easily identify systematic errors in a force field using the powerful
combination of the many-body expansion and energy decomposition analysis.

In order for a force field to be useful theoretical spectroscopy, it must respect the relationships
between structure and vibrational frequncies. In the case of water, this manifests as a linear
relationship between the change in bond length and change in \ce{O-H} stretching frequency.\cite{boyer2019beyond}
This is sometimes colloquially referred to as Badger's rule since Richard Badger famously pointed out a
correspondence between equilibrium bond lengths and bond force constants.\cite{badger1934relation}

In the course of constructing this force field, we tested if it satisfied the expected slope
$\Delta\omega$ vs $\Delta R_e$ of $\approx -19\ \mathrm{cm^{-1}/.001\AA}$\cite{boyer2019beyond}.
We found, instead, that the slope was around $\approx -11\ \mathrm{cm^{-1}/.001\AA}$ (See Fig. S2).
This is quite an interesting slope since Boyer \textit{et al.} show that a field-dependent Morse
oscillator, with parameters appropriate to water, will give a slope of $\approx -11\ \mathrm{cm^{-1}/.001\AA}$
if the dipole surface is constant. That is to say, in the field-dependent morse potential, the
bonding parameters are coupled to the environment via the dipole derivatives of the bond.
This was a strong indication that we should allow our bonding potential parameters to be modulated
by the field along that bond. How this is done is shown in Eq. \ref{eq:morse_field}

\begin{acknowledgement}

TODO

\end{acknowledgement}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% The same is true for Supporting Information, which should use the
%% suppinfo environment.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{suppinfo}

TODO

\end{suppinfo}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% The appropriate \bibliography command should be placed here.
%% Notice that the class file automatically sets \bibliographystyle
%% and also names the section correctly.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\bibliography{references}
\end{document}